---
title: "Encuesta sobre servicios de diagnóstico de laboratorios de micología en Perú"
author: "Diego Villa"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output:
  pdf_document:
    toc: yes
    toc_depth: '3'
  html_document:
    toc: yes
    toc_depth: 3
    toc_float: yes
    number_sections: yes
subtitle: Results
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)

is_html_output = function() {
  knitr::opts_knit$get("rmarkdown.pandoc.to") == "html"
}
```

```{r include=FALSE}
library(readr)
library(readxl)
library(dplyr)
library(stringr)
library(ggplot2)
library(forcats)
library(ggsci)
library(tidyr)
library(gtsummary)
library(downloadthis)
library(kableExtra)
library(rlang)
library(purrr)
library(cowplot)
```

```{r}
survey_raw <- read_excel(
  "data/raw/revisited-responses.xlsx", col_types = "text"
)
```

```{r echo=FALSE, warning=FALSE}
survey <- survey_raw %>% 
  mutate(
    across(
      c(
        years_myco_diag_lab, total_n_hosp_beds, n_tech_staff_lab, n_profe_staff_lab,
        total_n_staff, experience_member_1_lab, 
        experience_member_2_lab, experience_member_3_lab, experience_member_4_lab, 
        experience_member_5_lab,experience_member_6_lab, experience_member_7_lab, 
        total_n_staff_mico_lab, freq_myco_train_lab, 
        ave_scales_skin_hair_nails:ave_bone_marrow
        
      ), ~ as.numeric(.x)
    ),
    flg_lima = ifelse(department_hosp_lab == "Lima", "Lima", "Other regions"),
    capacity = case_when(
      category_hosp_lab == "II-1" | 
        category_hosp_lab == "II-2" |
        category_hosp_lab == "I-3" | 
        category_hosp_lab == "Hospital I - Essalud" |
        category_hosp_lab == "I-43" ~ "Low capacity",
      TRUE ~ "High capacity"
    )
  ) %>% 
  mutate(
    flg_lima = factor(flg_lima, levels = c("Other regions", "Lima")),
    capacity = factor(capacity, levels = c("Low capacity", "High capacity"))
  )
```

```{r plt_simple, include=FALSE}
plt_simple <- function(data, variable, levels, labels, title, ...) {
  tbl <- data %>% 
    group_by({{variable}}) %>% 
    summarise(count = n(), .groups = "drop") %>% 
    mutate(
      total = sum(count), prop = count / total, 
      text = sprintf("%.2f%% (%s)", 100*prop, count),
      variable = factor({{variable}}, levels = levels, labels = labels)
    ) %>% 
    mutate(variable = fct_explicit_na(variable, na_level = "No response"))
  
  plt <- tbl %>% 
    ggplot(aes(reorder(variable, prop), prop)) +
    geom_col(fill = "#01324f") +
    geom_text(aes(label = text), hjust = -0.1, size = 4) +
    scale_y_continuous(
      limits = c(0, max(tbl$prop) + 0.1), expand = c(0, 0), 
      labels = scales::percent
    ) +
    scale_x_discrete(expand = c(0, 0)) +
    labs(
      title = title,
      subtitle = sprintf(
        "Percentage and frequency (N = %s)", mean(tbl$total, na.rm = TRUE)
      ), x = NULL, y = NULL
    ) +
    theme_cowplot(14) +
    coord_flip() 
    
  plt
}
```

```{r plt_simple_facet, include=FALSE}
plt_simple_facet <- function(data, facet, variable, levels, labels, title, ...) {
  tbl <- data %>% 
    group_by(facet = {{facet}}, variable = {{variable}}) %>% 
    summarise(count = n()) %>% 
    mutate(total = sum(count), prop = count / total) %>% 
    ungroup() %>% 
    mutate(variable = factor(variable, levels = levels, labels = labels)) %>% 
    mutate(variable = fct_explicit_na(variable, na_level = "No response"))

  tbl_complete <- tbl %>% 
    complete(facet, variable) %>% 
    replace_na(list(count = 0, prop = 0)) %>% 
    group_by(facet) %>% 
    mutate(total = replace_na(total, mean(total, na.rm = TRUE))) %>% 
    ungroup() %>% 
    mutate(text = sprintf("%.2f%% (%s)", 100*prop, count))
  
  plt <- tbl_complete %>% 
    ggplot(aes(variable, prop)) +
    facet_grid(cols = vars(facet)) +
    geom_col(fill = "#01324f") +
    geom_text(aes(label = text), hjust = -0.1, size = 4) +
    scale_y_continuous(
      limits = c(0, max(tbl_complete$prop) + 0.18), expand = c(0, 0), 
      labels = scales::percent
    ) +
    scale_x_discrete(expand = c(0, 0)) +
    labs(title = title, x = NULL, y = NULL) +
    theme_cowplot(14) +
    coord_flip() 
      
  plt
}
```

```{r download_plt, include=FALSE}
download_plt <- function(plt, filename, height, width, ...) {
  if (is_html_output()) {
    plt %>% 
      download_this(
        output_name = filename, ggsave_args = list(height = height, width = width)
      )
  }
}
```

```{r make_tbl, include=FALSE}
make_tbl <- function(data, by=NULL, variable, label, ...) {
  variable_str <- as_name(enquo(variable))
  if (is.null(by)) {
    tbl <- data %>%
      tbl_summary(
        include = {{variable}}, label = setNames(list(label), variable_str),
        statistic = setNames(list(statistics), variable_str),
        digits = setNames(list(digits), variable_str),
        type = setNames(list(c("continuous2")), variable_str), missing = "ifany",
        missing_text = "No response"
      ) %>% 
      add_stat_label(label = setNames(list(stats_labels), variable_str))
  } else {
    tbl <- data %>%
      tbl_summary(
        by = by, include = {{variable}}, 
        label = setNames(list(label), variable_str),
        statistic = setNames(list(statistics), variable_str),
        digits = setNames(list(digits), variable_str),
        type = setNames(list(c("continuous2")), variable_str), missing = "ifany",
        missing_text = "No response"
      ) %>%
      add_overall(last = TRUE) %>% 
      add_stat_label(label = setNames(list(stats_labels), variable_str))
  }
  tbl
}
```

```{r show_tbl, include=FALSE}
show_tbl <- function(tbl, ...) {
  if (is_html_output()) {
    tbl %>% 
      modify_header(
        update = list(
          label = "**Characteristic**", 
          all_stat_cols(FALSE) ~ "**{level}**<br>N = {n}",
          stat_0 ~ "**Overall**<br>N = {N}"
        )
      )
  } else {
    tbl %>% 
      as_kable_extra(booktabs = TRUE) %>% 
      kable_styling(full_width = TRUE)
  }
}
```

```{r download_tbl, include=FALSE}
download_tbl <- function(tbl, filename, ...) {
  if (is_html_output()) {
    tbl %>% 
      modify_header(
        update = list(
          label = "Characteristic", all_stat_cols(FALSE) ~ "{level}, N = {n}",
          stat_0 ~ "Overall, N = {N}"
        )
      ) %>% 
      as_tibble() %>% 
      download_this(
        output_name = filename, output_extension = ".xlsx",
        button_label = "Download table"
      )
  }
}
```

```{r plot_multiple, include=FALSE}
plot_multiple <- function(data, cols, labels, title, fill_label, ...) {
  tbl <- data %>% 
    select({{cols}}) %>% 
    filter(if_any(everything(), ~ .x == "Seleccionados")) %>% 
    pivot_longer(everything()) %>% 
    group_by(name, value) %>% 
    summarise(count = n()) %>% 
    mutate(total = sum(count), prop = count / total) %>% 
    ungroup() %>% 
    complete(name, value) %>% 
    replace_na(list(count = 0, prop = 0)) %>% 
    mutate(across(c(name, value), as.factor))
  
  prop <- tbl %>% 
    filter(value == "Seleccionados") %>% 
    pull(prop)
  
  prop_order <- order(prop)
  
  tbl_plt <- tbl %>% 
    mutate(
      name = factor(
        name, levels = levels(name)[prop_order],
        labels = labels[prop_order]
      ),
      value = factor(
        value, levels = c("No seleccionados", "Seleccionados"),
        labels = c("No", "Yes")
      ),
      text = sprintf("%.2f%% (%s)", 100*prop, count)
    )
  
  plt <- tbl_plt %>% 
    ggplot(aes(name, prop, fill = value)) +
    geom_col(position = "stack") +
    scale_y_continuous(limits = c(0, 1), expand = c(0, 0), labels = scales::percent) +
    scale_x_discrete(expand = c(0, 0)) +
    labs(
      title = title,
      subtitle = sprintf(
        "Percentage by category (N = %s)", mean(tbl_plt$total, na.rm = TRUE)
      ),
      x = NULL, y = NULL, fill = fill_label
    ) +
    scale_fill_manual(values = c("Yes" = "#01324f", "No" = "#b2c1ca")) +
    theme_cowplot(14) +
    coord_flip()
  
  plt
}
```

```{r plt_multiple_facet, include=FALSE}
plot_multiple_facet <- function(data, facet, cols, labels, title, fill_label, ...) {
  tbl <- survey %>% 
    select(facet = {{facet}}, {{cols}}) %>% 
    filter(if_any(-facet, ~ .x == "Seleccionados")) %>% 
    pivot_longer(-facet) %>% 
    group_by(facet, name, value) %>% 
    summarise(count = n()) %>% 
    mutate(total = sum(count), prop = count / total) %>% 
    ungroup()
  
  tbl_complete <- tbl %>% 
    complete(facet, name, value) %>% 
    replace_na(list(count = 0, prop = 0)) %>% 
    mutate(across(c(name, value), as.factor)) %>% 
    group_by(facet, name) %>% 
    mutate(total = replace_na(total, mean(total, na.rm = TRUE))) %>% 
    ungroup()
  
  tbl_plt <- tbl_complete %>% 
    mutate(
      name = factor(name, levels = levels(name), labels = labels),
      value = factor(
        value, levels = c("No seleccionados", "Seleccionados"), 
        labels = c("No", "Yes")
      )
    ) %>% 
    mutate(name = fct_rev(name))
  
  plt <- tbl_plt %>% 
    ggplot(aes(name, prop, fill = value)) +
    facet_grid(cols = vars(facet)) +
    geom_col(position = "stack") +
    scale_y_continuous(limits = c(0, 1), expand = c(0, 0), labels = scales::percent) +
    scale_x_discrete(expand = c(0, 0)) +
    labs(
      title = title, subtitle = "Percentage by category", x = NULL, y = NULL, 
      fill = fill_label
    ) +
    scale_fill_manual(values = c("Yes" = "#01324f", "No" = "#b2c1ca")) +
    theme_cowplot(14) +
    coord_flip()
  
  plt
}
```

```{r}
statistics <- c(
  "{N_nonmiss}", "{min}, {max}", "{median} ({p25}, {p75})", "{mean} ({sd})"
)
stats_labels <- c("Responses", "Range", "Median (IQR)", "Mean (SD)")
digits <- c(0, 0, 0, 2, 2, 2, 2, 2)
```

```{r}
yes_no_levels <- c("No", "Sí")
yes_no_labels <- c("No", "Yes")
```

# General information 

## Region where the hospital/laboratory is located

```{r fig.height=2.5, fig.width=12, fig.align='center'}
region_plt <- plt_simple(
  survey, flg_lima, levels(survey$flg_lima), levels(survey$flg_lima), 
  title = "Region where the hospital/laboratory is located"
)

region_plt
```

```{r}
download_plt(region_plt, "region", height = 2.5, width = 9)
```

## Capacity of the hospital/laboratory

```{r fig.height=2.5, fig.width=12, fig.align='center'}
capacity_plt <- plt_simple(
  survey, capacity, levels(survey$capacity), levels(survey$capacity), 
  title = "Capacity of the hospital/laboratory"
)

capacity_plt
```

```{r}
download_plt(capacity_plt, "capacity", height = 2.5, width = 9)
```

## Time the laboratory has been carrying out mycological diagnoses

```{r}
years_myco_diag_tbl <- make_tbl(
  survey, variable = years_myco_diag_lab, 
  label = "Time (years) the laboratory has been carrying out mycological diagnoses"
)
```

```{r}
show_tbl(years_myco_diag_tbl)
```

<br>

```{r}
download_tbl(years_myco_diag_tbl, "years_myco_diag")
```

### By region

```{r}
years_myco_diag_region_tbl <- make_tbl(
  survey, by = "flg_lima", variable = years_myco_diag_lab,
  label = "Time (years) the laboratory has been carrying out mycological diagnoses"
)
```

```{r}
show_tbl(years_myco_diag_region_tbl)
```

<br>

```{r}
download_tbl(years_myco_diag_region_tbl, "years_myco_diag_region")
```

### By capacity

```{r}
years_myco_diag_capacity_tbl <- make_tbl(
  survey, by = "capacity", variable = years_myco_diag_lab,
  label = "Time (years) the laboratory has been carrying out mycological diagnoses"
)
```

```{r}
show_tbl(years_myco_diag_capacity_tbl)
```

<br>

```{r}
download_tbl(years_myco_diag_capacity_tbl, "years_myco_diag_capacity")
```

# Additional information about the hospital/health facility the laboratory belongs

## Total number of hospital beds

```{r}
hosp_beds_tbl <- make_tbl(
  survey, variable = total_n_hosp_beds,
  label = "Total number of hospital beds"
)
```

```{r}
show_tbl(hosp_beds_tbl)
```

<br>

```{r}
download_tbl(hosp_beds_tbl, "hosp_beds")
```

### By region

```{r}
hosp_beds_region_tbl <- make_tbl(
  survey, by = "flg_lima", variable = total_n_hosp_beds,
  label = "Total number of hospital beds"
)
```

```{r}
show_tbl(hosp_beds_region_tbl)
```

<br>

```{r}
download_tbl(hosp_beds_region_tbl, "hosp_beds_region")
```

### By capacity 

```{r}
hosp_beds_capacity_tbl <- make_tbl(
  survey, by = "capacity", variable = total_n_hosp_beds,
  label = "Total number of hospital beds"
)
```

```{r}
show_tbl(hosp_beds_capacity_tbl)
```

<br>

```{r}
download_tbl(hosp_beds_capacity_tbl, "hosp_beds_capacity")
```

## Available services in the hospital/health facility

```{r}
hosp_services_labels <- c(
  "COVID-19 area", "Oncohematology", "Infectology", "PROCETSS", "Adult ICU", 
  "Neonatal ICU", "Transplant Unit", "TB patient\ncare area"
)
```

```{r fig.height=6, fig.width=12, fig.align='center'}
hosp_services_plt <- plot_multiple(
  survey, services_hosp_lab___1:services_hosp_lab___8, 
  labels = hosp_services_labels, 
  title = "Which services are available in your hospital/health facility?",
  fill_label = "Available?"
)

hosp_services_plt
```

```{r}
download_plt(hosp_services_plt, "hosp_services", height = 6, width = 12)
```

### By region

```{r fig.height=5, fig.width=12, fig.align='center'}
hosp_services_region_plt <- survey %>% 
  plot_multiple_facet(
    facet = flg_lima, services_hosp_lab___1:services_hosp_lab___8, 
    labels = hosp_services_labels, 
    title = "Which services are available in your hospital/health facility?",
    fill_label = "Available?"
  )

hosp_services_region_plt
```

```{r}
download_plt(hosp_services_region_plt, "hosp_services_region", height = 5, width = 12)
```

### By capacity

```{r fig.height=5, fig.width=12, fig.align='center'}
hosp_services_capacity_plt <- survey %>% 
  plot_multiple_facet(
    facet = capacity, services_hosp_lab___1:services_hosp_lab___8, 
    labels = hosp_services_labels, 
    title = "Which services are available in your hospital/health facility?",
    fill_label = "Available?"
  )

hosp_services_capacity_plt
```

```{r}
download_plt(hosp_services_capacity_plt, "hosp_services_capacity", height = 5, width = 12)
```

# Additional information about the micology/microbiology laboratory

## Approximate area of the microbiology work zone

```{r}
area_levels <- c(
  "20 metros cuadrados o menos", "De 21 a 100 metros cuadrados", 
  "De 101 a 500 metros cuadrados"
)

area_labels <- c("Less than 21 m2", "21 to 100 m2", "101 to 500 m2\nor more")
```

```{r fig.height=3.5, fig.width=12, fig.align='center'}
area_plt <- plt_simple(
  survey, area_lab, area_levels, area_labels, 
  title = "What is the approximate microbiology work area?"
)

area_plt
```

```{r}
download_plt(area_plt, "area", height = 3.5, width = 12)
```

### By region

```{r fig.height=3, fig.width=12, fig.align='center'}
area_region_plt <- survey %>% 
  plt_simple_facet(
    flg_lima, area_lab, area_levels, area_labels,
    title = "What is the approximate microbiology work area?"
  )

area_region_plt
```

```{r}
download_plt(area_region_plt, "area_region", height = 3, width = 12)
```

### By capacity

```{r fig.height=3, fig.width=12, fig.align='center'}
area_capacity_plt <- survey %>% 
  plt_simple_facet(
    capacity, area_lab, area_levels, area_labels,
    title = "What is the approximate microbiology work area?"
  )

area_capacity_plt
```

```{r}
download_plt(area_capacity_plt, "area_capacity", height = 3, width = 12)
```

## Separated work zone for fungal diagnostic tests

```{r fig.height=2.5, fig.width=12, fig.align='center'}
flg_area_fungal_plt <- survey %>% 
  plt_simple(
    flg_separated_area_fungal_diag, yes_no_levels, yes_no_labels, 
    title = "Do you have a separate work zone for fungal diagnostic tests?"
)

flg_area_fungal_plt
```

```{r}
download_plt(flg_area_fungal_plt, "flg_area_fungal", height = 3.5, width = 12)
```

### By region

```{r fig.height=2.5, fig.width=12, fig.align='center'}
flg_area_fungal_region_plt <- survey %>% 
  plt_simple_facet(
    flg_lima, flg_separated_area_fungal_diag, yes_no_levels, yes_no_labels,
    title = "Do you have a separate work zone for fungal diagnostic tests?"
  )

flg_area_fungal_region_plt
```

```{r}
download_plt(
  flg_area_fungal_region_plt, "flg_area_fungal_region", height = 4, width = 12
)
```

### By capacity

```{r fig.height=2.5, fig.width=12, fig.align='center'}
flg_area_fungal_capacity_plt <- survey %>% 
  plt_simple_facet(
    capacity, flg_separated_area_fungal_diag, yes_no_levels, yes_no_labels,
    title = "Do you have a separate work zone for fungal diagnostic tests?"
  )

flg_area_fungal_capacity_plt
```

```{r}
download_plt(
  flg_area_fungal_capacity_plt, "flg_area_fungal_capacity", height = 2.5, 
  width = 12
)
```

## Work zone area for fungal diagnostic tests

```{r}
area_fungal_levels <- c("Menor o igual a 10 metros cuadrados", "Mayor a 10 metros cuadrados")
area_fungal_labels <- c("Less or equal\nthan 10 m2", "More than 10 m2")
```

```{r fig.height=2.5, fig.width=12, fig.align='center'}
area_fungal_plt <- survey %>% 
  filter(flg_separated_area_fungal_diag == "Sí") %>% 
  plt_simple(
    variable = area_diag_hongos, area_fungal_levels, area_fungal_labels, 
    title = "Work zone area for fungal diagnostic tests"
  )

area_fungal_plt
```

```{r}
download_plt(area_fungal_plt, "area_fungal", height = 2.5, width = 12)
```

### By region

```{r fig.height=2.5, fig.width=12, fig.align='center'}
area_fungal_region_plt <- survey %>% 
  filter(flg_separated_area_fungal_diag == "Sí") %>% 
  plt_simple_facet(
    flg_lima, area_diag_hongos, area_fungal_levels, area_fungal_labels,
    title = "Work zone area for fungal diagnostic tests"
  )

area_fungal_region_plt
```

```{r}
download_plt(
  area_fungal_region_plt, "area_fungal_region", height = 2.5, width = 12
)
```

### By capacity

```{r fig.height=2.5, fig.width=12, fig.align='center'}
area_fungal_capacity_plt <- survey %>% 
  filter(flg_separated_area_fungal_diag == "Sí") %>% 
  plt_simple_facet(
    capacity, area_diag_hongos, area_fungal_levels, area_fungal_labels,
    title = "Work zone area for fungal diagnostic tests"
  )

area_fungal_capacity_plt
```

```{r}
download_plt(
  area_fungal_capacity_plt, "area_fungal_capacity", height = 2.5, width = 12
)
```

## Available equipments for the diagnostic of fungi

```{r}
equip_fungal_labels <- c(
  "Compound\nmicroscope", "Fluorescence\nmicroscope", "Phase contrast\nmicroscope",
  "Stereoscope", "Incubator\nat 30 °C", "Incubator\nat 37 °C", "Incubator\nat 42 °C", 
  "Biological safety\ncabinet", "Thermoblock", "Centrifuge for\n10-15 ml tubes", 
  "Vortex", "ELISA reader", "Thermal cycler", "Thermal cycler\nfor real-time PCR", 
  "Automated\nequipment", "Others"
)
```

```{r fig.height=8, fig.width=12, fig.align='center'}
equip_fungal_plt <- plot_multiple(
  survey, equip_fungal_diag___1:equip_fungal_diag___16, 
  labels = equip_fungal_labels, 
  title = "Which equipements are available for the diagnosis of fungi?",
  fill_label = "Available?"
)

equip_fungal_plt
```

```{r}
download_plt(equip_fungal_plt, "equip_fungal", height = 8, width = 12)
```

### By region

```{r fig.height=8.5, fig.width=12, fig.align='center'}
equip_fungal_region_plt <- survey %>% 
  plot_multiple_facet(
    facet = flg_lima, equip_fungal_diag___1:equip_fungal_diag___16, 
    labels = equip_fungal_labels, 
    title = "Which equipements are available for the diagnosis of fungi?",
    fill_label = "Available?"
  )

equip_fungal_region_plt
```

```{r}
download_plt(equip_fungal_region_plt, "equip_fungal_region", height = 8.5, width = 12)
```

### By capacity

```{r fig.height=8.5, fig.width=12, fig.align='center'}
equip_fungal_capacity_plt <- survey %>% 
  plot_multiple_facet(
    facet = capacity, equip_fungal_diag___1:equip_fungal_diag___16, 
    labels = equip_fungal_labels, 
    title = "Which equipements are available for the diagnosis of fungi?",
    fill_label = "Available?"
  )

equip_fungal_capacity_plt
```

```{r}
download_plt(equip_fungal_capacity_plt, "equip_fungal_capacity", height = 8.5, width = 12)
```

# Accreditation and quality assessment

## Participation of the mycology laboratory in an external quality assessment scheme

```{r fig.height=2.5, fig.width=12, fig.align='center'}
flg_quality_plt <- survey %>% 
  plt_simple(
    flg_external_qual_assess_lab, yes_no_levels, yes_no_labels, 
    title = "Does the mycology laboratory participate in an external quality assessment scheme?"
  )

flg_quality_plt
```

```{r}
download_plt(flg_quality_plt, "flg_quality", height = 2.5, width = 12)
```

### By region

```{r fig.height=2.5, fig.width=12, fig.align='center'}
flg_quality_region_plt <- survey %>% 
  plt_simple_facet(
    flg_lima, flg_external_qual_assess_lab, yes_no_levels, yes_no_labels,
    title = "Does the mycology laboratory participate in an external quality assessment scheme?"
  )

flg_quality_region_plt
```

```{r}
download_plt(
  flg_quality_region_plt, "flg_quality_region", height = 2.5, width = 12
)
```

### By capacity

```{r fig.height=2.5, fig.width=12, fig.align='center'}
flg_quality_capacity_plt <- survey %>% 
  plt_simple_facet(
    capacity, flg_external_qual_assess_lab, yes_no_levels, yes_no_labels,
    title = "Does the mycology laboratory participate in an external quality assessment scheme?"
  )

flg_quality_capacity_plt
```

```{r}
download_plt(
  flg_quality_capacity_plt, "flg_quality_capacity", height = 2.5, width = 12
)
```

## Areas in which the mycology laboratory is evaluated

```{r}
areas_quality_labels <- c(
  "Serology", "Yeast\nidentification", "Identification of\nfilamentous fungi", 
  "Sensitivity to\nantifungals"
)
```

```{r fig.height=3.5, fig.width=12, fig.align='center'}
areas_quality_plt <- plot_multiple(
  survey, areas_external_qual_assess_lab___1:areas_external_qual_assess_lab___4, 
  labels = areas_quality_labels, 
  title = "In which areas is the mycology laboratory evaluated?",
  fill_label = "Evaluated?"
)

areas_quality_plt
```

```{r}
download_plt(areas_quality_plt, "areas_quality", height = 3.5, width = 12)
```

### By region

```{r fig.height=3.5, fig.width=12, fig.align='center'}
areas_quality_region_plt <- survey %>% 
  plot_multiple_facet(
    facet = flg_lima, 
    areas_external_qual_assess_lab___1:areas_external_qual_assess_lab___4, 
    labels = areas_quality_labels, 
    title = "In which areas is the mycology laboratory evaluated?",
    fill_label = "Evaluated?"
  )

areas_quality_region_plt
```

```{r}
download_plt(
  areas_quality_region_plt, "areas_quality_region", height = 3.5, width = 12
)
```

### By capacity

```{r fig.height=3.5, fig.width=12, fig.align='center'}
areas_quality_capacity_plt <- survey %>% 
  plot_multiple_facet(
    facet = flg_lima, 
    areas_external_qual_assess_lab___1:areas_external_qual_assess_lab___4, 
    labels = areas_quality_labels, 
    title = "In which areas is the mycology laboratory evaluated?",
    fill_label = "Evaluated?"
  )

areas_quality_capacity_plt
```

```{r}
download_plt(
  areas_quality_capacity_plt, "areas_quality_capacity", height = 3.5, width = 12
)
```

# Human resources

## Technical staff in the microbiology laboratory

```{r}
tech_staff_tbl <- survey %>% 
  filter(n_tech_staff_lab < 100) %>% 
  make_tbl(
    variable = n_tech_staff_lab, label = "Technical staff in the microbiology lab"
  )
```

```{r}
show_tbl(tech_staff_tbl)
```

<br>

```{r}
download_tbl(tech_staff_tbl, "tech_staff")
```

### By region

```{r}
tech_staff_region_tbl <- survey %>% 
  filter(n_tech_staff_lab < 100) %>% 
  make_tbl(
    by = "flg_lima", variable = n_tech_staff_lab, 
    label = "Technical staff in the microbiology lab"
  )
```

```{r}
show_tbl(tech_staff_region_tbl)
```

<br>

```{r}
download_tbl(tech_staff_region_tbl, "tech_staff_region")
```

### By capacity

```{r}
tech_staff_capacity_tbl <- survey %>% 
  filter(n_tech_staff_lab < 100) %>% 
  make_tbl(
    by = "capacity", variable = n_tech_staff_lab, 
    label = "Technical staff in the microbiology lab"
  )
```

```{r}
show_tbl(tech_staff_capacity_tbl)
```

<br>

```{r}
download_tbl(tech_staff_capacity_tbl, "tech_staff_capacity")
```

## Professional staff in the microbiology laboratory

```{r}
profe_staff_tbl <- survey %>% 
  filter(n_profe_staff_lab < 100) %>% 
  make_tbl(
    variable = n_profe_staff_lab, label = "Professional staff in the microbiology lab"
  )
```

```{r}
show_tbl(profe_staff_tbl)
```

<br>

```{r}
download_tbl(profe_staff_tbl, "profe_staff")
```

### By region

```{r}
profe_staff_region_tbl <- survey %>% 
  filter(n_profe_staff_lab < 100) %>% 
  make_tbl(
    by = "flg_lima", variable = n_profe_staff_lab, 
    label = "Professional staff in the microbiology lab"
  )
```

```{r}
show_tbl(profe_staff_region_tbl)
```

<br>

```{r}
download_tbl(profe_staff_region_tbl, "profe_staff_region")
```

### By capacity

```{r}
profe_staff_capacity_tbl <- survey %>% 
  filter(n_profe_staff_lab < 100) %>% 
  make_tbl(
    by = "capacity", variable = n_profe_staff_lab, 
    label = "Professional staff in the microbiology lab"
  )
```

```{r}
show_tbl(profe_staff_capacity_tbl)
```

<br>

```{r}
download_tbl(profe_staff_capacity_tbl, "profe_staff_capacity")
```

## Total staff in the microbiology laboratory

```{r}
total_staff_tbl <- survey %>% 
  filter(total_n_staff < 100) %>% 
  make_tbl(
    variable = total_n_staff, label = "Total staff in the microbiology lab"
  )
```

```{r}
show_tbl(total_staff_tbl)
```

<br>

```{r}
download_tbl(total_staff_tbl, "total_staff")
```

### By region

```{r}
total_staff_region_tbl <- survey %>% 
  filter(total_n_staff < 100) %>% 
  make_tbl(
    by = "flg_lima", variable = total_n_staff, 
    label = "Total staff in the microbiology lab"
  )
```

```{r}
show_tbl(total_staff_region_tbl)
```

<br>

```{r}
download_tbl(total_staff_region_tbl, "total_staff_region")
```

### By capacity

```{r}
total_staff_capacity_tbl <- survey %>% 
  filter(total_n_staff < 100) %>% 
  make_tbl(
    by = "capacity", variable = total_n_staff, 
    label = "Total staff in the microbiology lab"
  )
```

```{r}
show_tbl(total_staff_capacity_tbl)
```

<br>

```{r}
download_tbl(total_staff_capacity_tbl, "total_staff_capacity")
```

## Total staff in the mycology area

```{r}
total_staff_myco_tbl <- survey %>% 
  filter(total_n_staff_mico_lab < 100) %>% 
  mutate(total_n_staff_mico_lab = as.numeric(total_n_staff_mico_lab)) %>% 
  make_tbl(
    variable = total_n_staff_mico_lab, label = "Total staff in the mycology area"
  )
```

```{r}
show_tbl(total_staff_myco_tbl)
```

<br>

```{r}
download_tbl(total_staff_myco_tbl, "total_staff_myco")
```

### By region

```{r}
total_staff_myco_region_tbl <- survey %>% 
  filter(total_n_staff_mico_lab < 100) %>% 
  make_tbl(
    by = "flg_lima", variable = total_n_staff_mico_lab, 
    label = "Total staff in the mycology area"
  )
```

```{r}
show_tbl(total_staff_myco_region_tbl)
```

<br>

```{r}
download_tbl(total_staff_myco_region_tbl, "total_staff_myco_region")
```

### By capacity

```{r}
total_staff_myco_capacity_tbl <- survey %>% 
  filter(total_n_staff_mico_lab < 100) %>% 
  make_tbl(
    by = "capacity", variable = total_n_staff_mico_lab, 
    label = "Total staff in the mycology area"
  )
```

```{r}
show_tbl(total_staff_myco_capacity_tbl)
```

<br>

```{r}
download_tbl(total_staff_myco_capacity_tbl, "total_staff_myco_capacity")
```

## Mycology training/education program for mycology laboratory staff 

```{r fig.height=2.5, fig.width=12, fig.align='center'}
flg_train_plt <- survey %>% 
  plt_simple(
    flg_myco_train_lab, yes_no_levels, yes_no_labels, 
    title = "Does your institution have a mycology training program for the mycology laboratory staff?"
  )

flg_train_plt
```

```{r}
download_plt(flg_train_plt, "flg_train", height = 2.5, width = 12)
```

### By region

```{r fig.height=3, fig.width=12, fig.align='center'}
flg_train_region_plt <- survey %>% 
  plt_simple_facet(
    flg_lima, flg_myco_train_lab, yes_no_levels, yes_no_labels,
    title = "Does your institution have a mycology training program for the mycology laboratory staff?"
  )

flg_train_region_plt
```

```{r}
download_plt(
  flg_train_region_plt, "flg_train_region", height = 3, width = 12
)
```

### By capacity

```{r fig.height=3, fig.width=12, fig.align='center'}
flg_train_capacity_plt <- survey %>% 
  plt_simple_facet(
    capacity, flg_myco_train_lab, yes_no_levels, yes_no_labels,
    title = "Does your institution have a mycology training program for the mycology laboratory staff?"
  )

flg_train_capacity_plt
```

```{r}
download_plt(
  flg_train_capacity_plt, "flg_train_capacity", height = 3, width = 12
)
```

## Times a year the mycology trainigs are held

```{r}
freq_train_tbl <- survey %>% 
  filter(flg_myco_train_lab == "Sí") %>% 
  make_tbl(
    variable = freq_myco_train_lab, 
    label = "Times a year the mycology trainigs are held"
  )
```

```{r}
show_tbl(freq_train_tbl)
```

<br>

```{r}
download_tbl(freq_train_tbl, "freq_train")
```

### By region

```{r}
freq_train_region_tbl <- survey %>% 
  filter(flg_myco_train_lab == "Sí") %>% 
  make_tbl(
    by = "flg_lima", variable = freq_myco_train_lab, 
    label = "Times a year the mycology trainigs are held"
  )
```

```{r}
show_tbl(freq_train_region_tbl)
```

<br>

```{r}
download_tbl(freq_train_region_tbl, "freq_train_region")
```

### By capacity

```{r}
freq_train_capacity_tbl <- survey %>% 
  filter(flg_myco_train_lab == "Sí") %>% 
  make_tbl(
    by = "capacity", variable = freq_myco_train_lab, 
    label = "Times a year the mycology trainigs are held"
  )
```

```{r}
show_tbl(freq_train_capacity_tbl)
```

<br>

```{r}
download_tbl(freq_train_capacity_tbl, "freq_train_capacity")
```

## Training to other areas of the hospital/health facility

```{r fig.height=3, fig.width=12, fig.align='center'}
flg_train_other_plt <- survey %>% 
  plt_simple(
    flg_myco_lab_train_other_areas, yes_no_levels, yes_no_labels, 
    title = "Does the mycology laboratory carry out training aimed at other areas of the\nhospital/health facility?"
  )

flg_train_other_plt
```

```{r}
download_plt(flg_train_other_plt, "flg_train_other", height = 3, width = 12)
```

### By region

```{r fig.height=3, fig.width=12, fig.align='center'}
flg_train_other_region_plt <- survey %>% 
  plt_simple_facet(
    flg_lima, flg_myco_lab_train_other_areas, yes_no_levels, yes_no_labels,
    title = "Does the mycology laboratory carry out training aimed at other areas of the\nhospital/health facility?"
  )

flg_train_other_region_plt
```

```{r}
download_plt(
  flg_train_other_region_plt, "flg_train_other_region", height = 3, width = 12
)
```

### By capacity

```{r fig.height=3, fig.width=12, fig.align='center'}
flg_train_other_capacity_plt <- survey %>% 
  plt_simple_facet(
    capacity, flg_myco_lab_train_other_areas, yes_no_levels, yes_no_labels,
    title = "Does the mycology laboratory carry out training aimed at other areas of the\nhospital/health facility?"
  )

flg_train_other_capacity_plt
```

```{r}
download_plt(
  flg_train_other_capacity_plt, "flg_train_other_capacity", height = 3, width = 12
)
```

## Audience of the trainings carried out by the mycology laboratory

```{r}
train_staff_labels <- c(
  "Laboratory\nstaff", "Clinical\nstaff", "Others"
)
```

```{r fig.height=3, fig.width=12, fig.align='center'}
train_staff_plt <- survey %>% 
  filter(flg_myco_lab_train_other_areas == "Sí") %>% 
  plot_multiple(
    type_staff_myco_lab_train___1:type_staff_myco_lab_train___3, 
    labels = train_staff_labels, 
    title = "Who is the training carried out by the mycology laboratory aimed at?",
    fill_label = "Aimed at?"
  )

train_staff_plt
```

```{r}
download_plt(train_staff_plt, "train_staff", height = 3, width = 12)
```

# Internal demand for mycological tests

## Average number of samples for mycosis diagnosis before COVID-19

```{r}
samples_levels <- c("De 1 a 10", "De 11 a 20", "De 21 a 40", "Más de 40")
samples_labels <- c("1 to 10", "11 to 20", "21 to 40", "More than 40")
```

```{r fig.height=4, fig.width=12, fig.align='center'}
samples_before_covid_plt <- plt_simple(
    survey, n_samples_myco_before_covid, samples_levels, samples_labels, 
    title = "Average number of samples for mycosis diagnosis before COVID-19"
  )

samples_before_covid_plt
```

```{r}
download_plt(samples_before_covid_plt, "samples_before_covid", height = 4, width = 12)
```

### By region

```{r fig.height=4, fig.width=12, fig.align='center'}
samples_before_covid_region_plt <- survey %>% 
  plt_simple_facet(
    flg_lima, n_samples_myco_before_covid, samples_levels, samples_labels,
    title = "Average number of samples for mycosis diagnosis before COVID-19"
  )

samples_before_covid_region_plt
```

```{r}
download_plt(
  samples_before_covid_region_plt, "samples_before_covid_region", height = 4, 
  width = 12
)
```

### By capacity

```{r fig.height=4, fig.width=12, fig.align='center'}
samples_before_covid_capacity_plt <- survey %>% 
  plt_simple_facet(
    capacity, n_samples_myco_before_covid, samples_levels, samples_labels,
    title = "Average number of samples for mycosis diagnosis before COVID-19"
  )

samples_before_covid_capacity_plt
```

```{r}
download_plt(
  samples_before_covid_capacity_plt, "samples_before_covid_capacity", height = 4, 
  width = 12
)
```

## Average number of samples for mycosis diagnosis in the last 3 months

```{r fig.height=4, fig.width=12, fig.align='center'}
samples_present_plt <- plt_simple(
    survey, n_samples_myco_present, samples_levels, samples_labels, 
    title = "Average number of samples for mycosis diagnosis in the last 3 months"
  )

samples_present_plt
```

```{r}
download_plt(samples_present_plt, "samples_present", height = 4, width = 12)
```

### By region

```{r fig.height=4, fig.width=12, fig.align='center'}
samples_present_region_plt <- survey %>% 
  plt_simple_facet(
    flg_lima, n_samples_myco_present, samples_levels, samples_labels,
    title = "Average number of samples for mycosis diagnosis before COVID-19"
  )

samples_present_region_plt
```

```{r}
download_plt(
  samples_present_region_plt, "samples_present_region", height = 4, 
  width = 12
)
```

### By capacity

```{r fig.height=4, fig.width=12, fig.align='center'}
samples_present_capacity_plt <- survey %>% 
  plt_simple_facet(
    capacity, n_samples_myco_present, samples_levels, samples_labels,
    title = "Average number of samples for mycosis diagnosis before COVID-19"
  )

samples_present_capacity_plt
```

```{r}
download_plt(
  samples_present_capacity_plt, "samples_present_capacity", height = 4, 
  width = 12
)
```

## Departments/units that have sent samples for the diagnosis of mycoses

```{r}
hosp_units_labels <- c(
  "Hosp.:\nMedicine", "Hosp.:\nGynecology", "Hosp.:\nSurgery", "Hosp.:\nPediatrics", 
  "Hosp.:\nInfectology", "ICU", "Outpatient:\nInfectology", "Outpatient:\nDermatology", 
  "Outpatient:\nGynecology", "Outpatient:\nPneumology", "Oncology", "Transplants", 
  "Others"
)
```

```{r fig.height=8, fig.width=12, fig.align='center'}
units_samples_plt <- survey %>% 
  plot_multiple(
    hosp_units_samples_myco___1:hosp_units_samples_myco___13, 
    labels = hosp_units_labels, 
    title = "In the last 3 months, which hospital departments/units have sent samples for\nmycological diagnostic?",
    fill_label = "Have they\nsent?"
  )

units_samples_plt
```

```{r}
download_plt(units_samples_plt, "units_sample", height = 8, width = 12)
```

### By region

```{r fig.height=7.5, fig.width=12, fig.align='center'}
units_samples_region_plt <- survey %>% 
  plot_multiple_facet(
    facet = flg_lima, 
    hosp_units_samples_myco___1:hosp_units_samples_myco___13, 
    labels = hosp_units_labels, 
    title = "In the last 3 months, which hospital departments/units have sent samples for\nmycological diagnostic?",
    fill_label = "Have they\nsent?"
  )

units_samples_region_plt
```

```{r}
download_plt(
  units_samples_region_plt, "units_samples_region", height = 7.5, width = 12
)
```

### By capacity

```{r fig.height=7.5, fig.width=12, fig.align='center'}
units_samples_capacity_plt <- survey %>% 
  plot_multiple_facet(
    facet = capacity, 
    hosp_units_samples_myco___1:hosp_units_samples_myco___13, 
    labels = hosp_units_labels, 
    title = "In the last 3 months, which hospital departments/units have sent samples for\nmycological diagnostic?",
    fill_label = "Have they\nsent?"
  )

units_samples_capacity_plt
```

```{r}
download_plt(
  units_samples_capacity_plt, "units_samples_capacity", height = 7.5, width = 12
)
```

## Most frequent sample types processed in the last 3 months

```{r}
sample_type_labels <- c(
  "Skin scales,\nhair, nails", "Sputum, bronchial aspirate,\nbronchial brushing", 
  "Bronchoalveolar\nlavage", "Mucosal\nexudates", "Biopsies", "Urine", "Blood", 
  "Intravascular\ncatheter", "Cerebrospinal fluid\ncollection", "Bone marrow", 
  "Others"
)
```

```{r fig.height=7, fig.width=12, fig.align='center'}
most_freq_samples_plt <- survey %>% 
  plot_multiple(
    most_freq_sample_types_myco___1:most_freq_sample_types_myco___11, 
    labels = sample_type_labels, 
    title = "In the last 3 months, what type of sample have you processed most frequently for the\ndiagnosis of mycoses?",
    fill_label = "Most frequent?"
  )

most_freq_samples_plt
```

```{r}
download_plt(most_freq_samples_plt, "most_freq_samples", height = 8, width = 12)
```

### By region

```{r fig.height=7, fig.width=12, fig.align='center'}
most_freq_samples_region_plt <- survey %>% 
  plot_multiple_facet(
    facet = flg_lima, 
    most_freq_sample_types_myco___1:most_freq_sample_types_myco___11, 
    labels = sample_type_labels, 
    title = "In the last 3 months, what type of sample have you processed most frequently for the\ndiagnosis of mycoses?",
    fill_label = "Most frequent?"
  )

most_freq_samples_region_plt
```

```{r}
download_plt(
  most_freq_samples_region_plt, "most_freq_samples_region", height = 7, width = 12
)
```

### By capacity

```{r fig.height=7, fig.width=12, fig.align='center'}
most_freq_samples_capacity_plt <- survey %>% 
  plot_multiple_facet(
    facet = capacity, 
    most_freq_sample_types_myco___1:most_freq_sample_types_myco___11, 
    labels = sample_type_labels, 
    title = "In the last 3 months, what type of sample have you processed most frequently for the\ndiagnosis of mycoses?",
    fill_label = "Most frequent?"
  )

most_freq_samples_capacity_plt
```

```{r}
download_plt(
  most_freq_samples_capacity_plt, "most_freq_samples_capacity", height = 7, width = 12
)
```

## Average number of processed samples (last 3 months)

### Skin scales, hair or nails

```{r}
skin_scales_tbl <- survey %>% 
  filter(most_freq_sample_types_myco___1 == "Seleccionados") %>% 
  make_tbl(
    variable = ave_scales_skin_hair_nails, 
    label = "Skin scales, hair or nails"
  )
```

```{r}
show_tbl(skin_scales_tbl)
```

<br>

```{r}
download_tbl(skin_scales_tbl, "skin_scales")
```

#### By region

```{r}
skin_scales_region_tbl <- survey %>% 
  filter(most_freq_sample_types_myco___1 == "Seleccionados") %>%  
  make_tbl(
    by = "flg_lima", variable = ave_scales_skin_hair_nails, 
    label = "Skin scales, hair or nails"
  )
```

```{r}
show_tbl(skin_scales_region_tbl)
```

<br>

```{r}
download_tbl(skin_scales_region_tbl, "skin_scales_region")
```

#### By capacity

```{r}
skin_scales_capacity_tbl <- survey %>% 
  filter(most_freq_sample_types_myco___1 == "Seleccionados") %>%  
  make_tbl(
    by = "capacity", variable = ave_scales_skin_hair_nails, 
    label = "Skin scales, hair or nails"
  )
```

```{r}
show_tbl(skin_scales_capacity_tbl)
```

<br>

```{r}
download_tbl(skin_scales_capacity_tbl, "skin_scales_capacity")
```

### Sputum, bronchoaspirate or bronchial brushing

```{r}
sputum_tbl <- survey %>% 
  filter(most_freq_sample_types_myco___2 == "Seleccionados") %>% 
  make_tbl(
    variable = ave_sputum_aspiration_bronchial_brushing, 
    label = "Sputum, bronchoaspirate or bronchial brushing"
  )
```

```{r}
show_tbl(sputum_tbl)
```

<br>

```{r}
download_tbl(sputum_tbl, "sputum")
```

#### By region

```{r}
sputum_region_tbl <- survey %>% 
  filter(most_freq_sample_types_myco___2 == "Seleccionados") %>%  
  make_tbl(
    by = "flg_lima", variable = ave_sputum_aspiration_bronchial_brushing, 
    label = "Sputum, bronchoaspirate or bronchial brushing"
  )
```

```{r}
show_tbl(sputum_region_tbl)
```

<br>

```{r}
download_tbl(sputum_region_tbl, "sputum_region")
```

#### By capacity

```{r}
sputum_capacity_tbl <- survey %>% 
  filter(most_freq_sample_types_myco___2 == "Seleccionados") %>%  
  make_tbl(
    by = "capacity", variable = ave_sputum_aspiration_bronchial_brushing, 
    label = "Sputum, bronchoaspirate or bronchial brushing"
  )
```

```{r}
show_tbl(sputum_capacity_tbl)
```

<br>

```{r}
download_tbl(sputum_capacity_tbl, "sputum_capacity")
```

### Mucosal exudates

```{r}
mucosal_tbl <- survey %>% 
  filter(most_freq_sample_types_myco___4 == "Seleccionados") %>% 
  make_tbl(
    variable = ave_mucosal_exudates, 
    label = "Mucosal exudates"
  )
```

```{r}
show_tbl(mucosal_tbl)
```

<br>

```{r}
download_tbl(mucosal_tbl, "mucosal")
```

#### By region

```{r}
mucosal_region_tbl <- survey %>% 
  filter(most_freq_sample_types_myco___4 == "Seleccionados") %>%  
  make_tbl(
    by = "flg_lima", variable = ave_mucosal_exudates, 
    label = "Mucosal exudates"
  )
```

```{r}
show_tbl(mucosal_region_tbl)
```

<br>

```{r}
download_tbl(mucosal_region_tbl, "mucosal_region")
```

#### By capacity

```{r}
mucosal_capacity_tbl <- survey %>% 
  filter(most_freq_sample_types_myco___4 == "Seleccionados") %>%  
  make_tbl(
    by = "capacity", variable = ave_mucosal_exudates, 
    label = "Mucosal exudates"
  )
```

```{r}
show_tbl(mucosal_capacity_tbl)
```

<br>

```{r}
download_tbl(mucosal_capacity_tbl, "mucosal_capacity")
```

### Biopsies

```{r}
biopsies_tbl <- survey %>% 
  filter(most_freq_sample_types_myco___5 == "Seleccionados") %>% 
  make_tbl(
    variable = ave_biopsies, 
    label = "Biopsies"
  )
```

```{r}
show_tbl(biopsies_tbl)
```

<br>

```{r}
download_tbl(biopsies_tbl, "biopsies")
```

#### By region

```{r}
biopsies_region_tbl <- survey %>% 
  filter(most_freq_sample_types_myco___5 == "Seleccionados") %>%  
  make_tbl(
    by = "flg_lima", variable = ave_biopsies, 
    label = "Mucosal exudates"
  )
```

```{r}
show_tbl(biopsies_region_tbl)
```

<br>

```{r}
download_tbl(biopsies_region_tbl, "biopsies_region")
```

#### By capacity

```{r}
biopsies_capacity_tbl <- survey %>% 
  filter(most_freq_sample_types_myco___5 == "Seleccionados") %>%  
  make_tbl(
    by = "capacity", variable = ave_biopsies, 
    label = "Mucosal exudates"
  )
```

```{r}
show_tbl(biopsies_capacity_tbl)
```

<br>

```{r}
download_tbl(biopsies_capacity_tbl, "biopsies_capacity")
```

### Urine

```{r}
urine_tbl <- survey %>% 
  filter(most_freq_sample_types_myco___6 == "Seleccionados") %>% 
  make_tbl(
    variable = ave_urine, 
    label = "Urine"
  )
```

```{r}
show_tbl(urine_tbl)
```

<br>

```{r}
download_tbl(urine_tbl, "urine")
```

#### By region

```{r}
urine_region_tbl <- survey %>% 
  filter(most_freq_sample_types_myco___6 == "Seleccionados") %>%  
  make_tbl(
    by = "flg_lima", variable = ave_urine, 
    label = "Urine"
  )
```

```{r}
show_tbl(urine_region_tbl)
```

<br>

```{r}
download_tbl(urine_region_tbl, "urine_region")
```

#### By capacity

```{r}
urine_capacity_tbl <- survey %>% 
  filter(most_freq_sample_types_myco___6 == "Seleccionados") %>%  
  make_tbl(
    by = "capacity", variable = ave_urine, 
    label = "Urine"
  )
```

```{r}
show_tbl(urine_capacity_tbl)
```

<br>

```{r}
download_tbl(urine_capacity_tbl, "urine_capacity")
```

### Blood

```{r}
blood_tbl <- survey %>% 
  filter(most_freq_sample_types_myco___7 == "Seleccionados") %>% 
  make_tbl(
    variable = ave_blood, 
    label = "Blood"
  )
```

```{r}
show_tbl(blood_tbl)
```

<br>

```{r}
download_tbl(blood_tbl, "blood")
```

#### By region

```{r}
blood_region_tbl <- survey %>% 
  filter(most_freq_sample_types_myco___7 == "Seleccionados") %>%  
  make_tbl(
    by = "flg_lima", variable = ave_blood, 
    label = "Blood"
  )
```

```{r}
show_tbl(blood_region_tbl)
```

<br>

```{r}
download_tbl(blood_region_tbl, "blood_region")
```

#### By capacity

```{r}
blood_capacity_tbl <- survey %>% 
  filter(most_freq_sample_types_myco___7 == "Seleccionados") %>%  
  make_tbl(
    by = "capacity", variable = ave_blood, 
    label = "Blood"
  )
```

```{r}
show_tbl(blood_capacity_tbl)
```

<br>

```{r}
download_tbl(blood_capacity_tbl, "blood_capacity")
```

### Intravascular catheter

```{r}
intravascular_tbl <- survey %>% 
  filter(most_freq_sample_types_myco___8 == "Seleccionados") %>% 
  make_tbl(
    variable = ave_intravascular_catheter, 
    label = "Intravascular catheter"
  )
```

```{r}
show_tbl(intravascular_tbl)
```

<br>

```{r}
download_tbl(intravascular_tbl, "intravascular")
```

#### By region

```{r}
intravascular_region_tbl <- survey %>% 
  filter(most_freq_sample_types_myco___8 == "Seleccionados") %>%  
  make_tbl(
    by = "flg_lima", variable = ave_intravascular_catheter, 
    label = "Intravascular catheter"
  )
```

```{r}
show_tbl(intravascular_region_tbl)
```

<br>

```{r}
download_tbl(intravascular_region_tbl, "intravascular_region")
```

#### By capacity

```{r}
intravascular_capacity_tbl <- survey %>% 
  filter(most_freq_sample_types_myco___8 == "Seleccionados") %>%  
  make_tbl(
    by = "capacity", variable = ave_intravascular_catheter, 
    label = "Intravascular catheter"
  )
```

```{r}
show_tbl(intravascular_capacity_tbl)
```

<br>

```{r}
download_tbl(intravascular_capacity_tbl, "intravascular_capacity")
```

### Cerebrospinal fluid collection

```{r}
lcr_tbl <- survey %>% 
  filter(most_freq_sample_types_myco___9 == "Seleccionados") %>% 
  make_tbl(
    variable = ave_lcr, 
    label = "Cerebrospinal fluid collection"
  )
```

```{r}
show_tbl(lcr_tbl)
```

<br>

```{r}
download_tbl(lcr_tbl, "lcr")
```

#### By region

```{r}
lcr_region_tbl <- survey %>% 
  filter(most_freq_sample_types_myco___9 == "Seleccionados") %>%  
  make_tbl(
    by = "flg_lima", variable = ave_lcr, 
    label = "Cerebrospinal fluid collection"
  )
```

```{r}
show_tbl(lcr_region_tbl)
```

<br>

```{r}
download_tbl(lcr_region_tbl, "lcr_region")
```

#### By capacity

```{r}
lcr_capacity_tbl <- survey %>% 
  filter(most_freq_sample_types_myco___9 == "Seleccionados") %>%  
  make_tbl(
    by = "capacity", variable = ave_lcr, 
    label = "Cerebrospinal fluid collection"
  )
```

```{r}
show_tbl(lcr_capacity_tbl)
```

<br>

```{r}
download_tbl(lcr_capacity_tbl, "lcr_capacity")
```

### Bone marrow

```{r}
bone_tbl <- survey %>% 
  filter(most_freq_sample_types_myco___10 == "Seleccionados") %>% 
  make_tbl(
    variable = ave_bone_marrow, 
    label = "Bone marrow"
  )
```

```{r}
show_tbl(bone_tbl)
```

<br>

```{r}
download_tbl(bone_tbl, "bone_marrow")
```

#### By region

```{r}
bone_region_tbl <- survey %>% 
  filter(most_freq_sample_types_myco___10 == "Seleccionados") %>%  
  make_tbl(
    by = "flg_lima", variable = ave_bone_marrow, 
    label = "Bone marrow"
  )
```

```{r}
show_tbl(bone_region_tbl)
```

<br>

```{r}
download_tbl(bone_region_tbl, "bone_region")
```

#### By capacity

```{r}
bone_capacity_tbl <- survey %>% 
  filter(most_freq_sample_types_myco___10 == "Seleccionados") %>%  
  make_tbl(
    by = "capacity", variable = ave_bone_marrow, 
    label = "Bone marrow"
  )
```

```{r}
show_tbl(bone_capacity_tbl)
```

<br>

```{r}
download_tbl(bone_capacity_tbl, "bone_capacity")
```

# Microscopic examinations

## Does the mycology laboratory perform microscopic examinations?

```{r fig.height=2.5, fig.width=12, fig.align='center'}
flg_micro_plt <- survey %>% 
  plt_simple(
    flg_micro_tests_lab, yes_no_levels, yes_no_labels, 
    title = "Does the mycology laboratory perform microscopic examinations?"
  )

flg_micro_plt
```

```{r}
download_plt(flg_micro_plt, "flg_micro", height = 2.5, width = 12)
```

### By region

```{r fig.height=2.5, fig.width=12, fig.align='center'}
flg_micro_region_plt <- survey %>% 
  plt_simple_facet(
    flg_lima, flg_micro_tests_lab, yes_no_levels, yes_no_labels,
    title = "Does the mycology laboratory perform microscopic examinations?"
  )

flg_micro_region_plt
```

```{r}
download_plt(
  flg_micro_region_plt, "flg_micro_region", height = 2.5, width = 12
)
```

### By capacity

```{r fig.height=2.5, fig.width=12, fig.align='center'}
flg_micro_capacity_plt <- survey %>% 
  plt_simple_facet(
    capacity, flg_micro_tests_lab, yes_no_levels, yes_no_labels,
    title = "Does the mycology laboratory perform microscopic examinations?"
  )

flg_micro_capacity_plt
```

```{r}
download_plt(
  flg_micro_capacity_plt, "flg_micro_capacity", height = 2.5, 
  width = 12
)
```

## Available microscopic examinations

```{r}
micro_test_labels <- c(
  "KOH preparation", "Chinese ink\nstain", "Lactophenol blue\nstain", 
  "Grocott's methenamine\nsilver stain", "Calcofluor stain", "Gram stain", 
  "Giemsa stain", "Others"
)
```

```{r fig.height=6, fig.width=12, fig.align='center'}
micro_test_plt <- survey %>% 
  plot_multiple(
    micro_tests_lab___1:micro_tests_lab___8, 
    labels = micro_test_labels, 
    title = "What microscopic examinations are available in your laboratory?",
    fill_label = "Available?"
  )

micro_test_plt
```

```{r}
download_plt(micro_test_plt, "micro_tests", height = 6, width = 12)
```

### By region

```{r fig.height=5, fig.width=12, fig.align='center'}
micro_test_region_plt <- survey %>% 
  plot_multiple_facet(
    facet = flg_lima, micro_tests_lab___1:micro_tests_lab___8, 
    labels = micro_test_labels, 
    title = "What microscopic examinations are available in your laboratory?",
    fill_label = "Available?"
  )

micro_test_region_plt
```

```{r}
download_plt(micro_test_region_plt, "micro_test_region", height = 5, width = 12)
```

### By capacity

```{r fig.height=5, fig.width=12, fig.align='center'}
equip_fungal_capacity_plt <- survey %>% 
  plot_multiple_facet(
    facet = capacity, micro_tests_lab___1:micro_tests_lab___8, 
    labels = micro_test_labels, 
    title = "What microscopic examinations are available in your laboratory?",
    fill_label = "Available?"
  )

equip_fungal_capacity_plt
```

```{r}
download_plt(equip_fungal_capacity_plt, "equip_fungal_capacity", height = 5, width = 12)
```

## Delivery time of chinese ink stain test results

```{r}
delivery_chinese_levels <- c("Dentro de 24 horas", "Más de 24 horas")
delivery_chinese_labels <- c("Within 24 h", "More than 24 h")
```

```{r fig.height=2.5, fig.width=12, fig.align='center'}
delivery_chinese_plt <- survey %>% 
  filter(micro_tests_lab___2 == "Seleccionados") %>%
  plt_simple(
    results_delivery_time_china, delivery_chinese_levels, delivery_chinese_labels, 
    title = "How long does it take to deliver the chinese ink stain test results after receiving the sample?"
  )

delivery_chinese_plt
```

```{r}
download_plt(delivery_chinese_plt, "delivery_chinese", height = 2.5, width = 12)
```

### By region

```{r fig.height=2.5, fig.width=12, fig.align='center'}
delivery_chinese_region_plt <- survey %>% 
  filter(micro_tests_lab___2 == "Seleccionados") %>%
  plt_simple_facet(
    flg_lima, results_delivery_time_china, delivery_chinese_levels, 
    delivery_chinese_labels,
    title = "How long does it take to deliver the chinese ink stain test results after receiving the sample?"
  )

delivery_chinese_region_plt
```

```{r}
download_plt(
  delivery_chinese_region_plt, "delivery_chinese_region", height = 2.5, width = 12
)
```

### By capacity

```{r fig.height=2.5, fig.width=12, fig.align='center'}
delivery_chinese_capacity_plt <- survey %>% 
  filter(micro_tests_lab___2 == "Seleccionados") %>%
  plt_simple_facet(
    capacity, results_delivery_time_china, delivery_chinese_levels, 
    delivery_chinese_labels,
    title = "How long does it take to deliver the chinese ink stain test results after receiving the sample?"
  )

delivery_chinese_capacity_plt
```

```{r}
download_plt(
  delivery_chinese_capacity_plt, "delivery_chinese_capacity", height = 2.5, width = 12
)
```

## Delivery time of Giemsa ink stain test results

```{r}
delivery_giemsa_levels <- c("Dentro de 24 horas", "Más de 24 horas")
delivery_giemsa_labels <- c("Within 24 h", "More than 24 h")
```

```{r fig.height=2.5, fig.width=12, fig.align='center'}
delivery_giemsa_plt <- survey %>% 
  filter(micro_tests_lab___7 == "Seleccionados") %>%
  plt_simple(
    results_delivery_time_giemsa, delivery_giemsa_levels, delivery_giemsa_labels, 
    title = "How long does it take to deliver the giemsa ink stain test results after receiving the sample?"
  )

delivery_giemsa_plt
```

```{r}
download_plt(delivery_giemsa_plt, "delivery_giemsa", height = 2.5, width = 12)
```

### By region

```{r fig.height=2.5, fig.width=12, fig.align='center'}
delivery_giemsa_region_plt <- survey %>% 
  filter(micro_tests_lab___7 == "Seleccionados") %>%
  plt_simple_facet(
    flg_lima, results_delivery_time_giemsa, delivery_giemsa_levels, 
    delivery_giemsa_labels,
    title = "How long does it take to deliver the giemsa ink stain test results after receiving the sample?"
  )

delivery_giemsa_region_plt
```

```{r}
download_plt(
  delivery_giemsa_region_plt, "delivery_giemsa_region", height = 2.5, width = 12
)
```

### By capacity

```{r fig.height=2.5, fig.width=12, fig.align='center'}
delivery_giemsa_capacity_plt <- survey %>% 
  filter(micro_tests_lab___7 == "Seleccionados") %>%
  plt_simple_facet(
    capacity, results_delivery_time_giemsa, delivery_giemsa_levels, 
    delivery_giemsa_labels,
    title = "How long does it take to deliver the giemsa ink stain test results after receiving the sample?"
  )

delivery_giemsa_capacity_plt
```

```{r}
download_plt(
  delivery_giemsa_capacity_plt, "delivery_giemsa_capacity", height = 2.5, width = 12
)
```

## Results delivery method

```{r}
delivery_method_labels <- c(
  "Physical format", "Email", "Phone", "Results web page", "Others"
)
```

```{r fig.height=4, fig.width=12, fig.align='center'}
delivery_method_plt <- survey %>% 
  filter(flg_micro_tests_lab == "Sí") %>% 
  plot_multiple(
    results_delivery_method_micro___1:results_delivery_method_micro___5, 
    labels = delivery_method_labels, 
    title = "What results delivery methods do you use?",
    fill_label = "Available?"
  )

delivery_method_plt
```

```{r}
download_plt(delivery_method_plt, "delivery_methods", height = 4, width = 12)
```

### By region

```{r fig.height=3, fig.width=12, fig.align='center'}
delivery_method_region_plt <- survey %>% 
  filter(flg_micro_tests_lab == "Sí") %>% 
  plot_multiple_facet(
    facet = flg_lima, 
    results_delivery_method_micro___1:results_delivery_method_micro___5, 
    labels = delivery_method_labels, 
    title = "What results delivery methods do you use?",
    fill_label = "Available?"
  )

delivery_method_region_plt
```

```{r}
download_plt(
  delivery_method_region_plt, "delivery_method_region", height = 3, width = 12
)
```

### By capacity

```{r fig.height=3, fig.width=12, fig.align='center'}
delivery_method_capacity_plt <- survey %>% 
  filter(flg_micro_tests_lab == "Sí") %>% 
  plot_multiple_facet(
    facet = capacity, 
    results_delivery_method_micro___1:results_delivery_method_micro___5, 
    labels = delivery_method_labels, 
    title = "What results delivery methods do you use?",
    fill_label = "Available?"
  )

delivery_method_capacity_plt
```

```{r}
download_plt(
  delivery_method_capacity_plt, "delivery_method_capacity", height = 3, width = 12
)
```

# Fungal identification: Yeast

## Available culture medias for yeast identification

```{r}
culture_media_labels <- c(
  "Sabouraud 4% dextrose agar\nwith chloramphenicol", "Blood agar", "BHI agar", 
  "Mycobiotic agar", "Others"
)
```

```{r fig.height=4, fig.width=12, fig.align='center'}
yeast_culture_medias_plt <- survey %>% 
  plot_multiple(
    culture_media_yeast___1:culture_media_yeast___5, 
    labels = culture_media_labels, 
    title = "Which types of culture medias are available in your laboratory for yeast identification?",
    fill_label = "Available?"
  )

yeast_culture_medias_plt
```

```{r}
download_plt(yeast_culture_medias_plt, "yeast_culture_medias", height = 4, width = 12)
```

### By region

```{r fig.height=3.5, fig.width=12, fig.align='center'}
yeast_culture_medias_region_plt <- survey %>% 
  plot_multiple_facet(
    facet = flg_lima, 
    culture_media_yeast___1:culture_media_yeast___5, 
    labels = culture_media_labels, 
    title = "Which types of culture medias are available in your laboratory for yeast identification?",
    fill_label = "Available?"
  )

yeast_culture_medias_region_plt
```

```{r}
download_plt(
  yeast_culture_medias_region_plt, "yeast_culture_medias_region", height = 9, 
  width = 12
)
```

### By capacity

```{r fig.height=3.5, fig.width=12, fig.align='center'}
yeast_culture_medias_capacity_plt <- survey %>% 
  plot_multiple_facet(
    facet = capacity, 
    culture_media_yeast___1:culture_media_yeast___5, 
    labels = culture_media_labels, 
    title = "Which types of culture medias are available in your laboratory for yeast identification?",
    fill_label = "Available?"
  )

yeast_culture_medias_capacity_plt
```

```{r}
download_plt(
  yeast_culture_medias_capacity_plt, "yeast_culture_medias_capacity", height = 3.5, 
  width = 12
)
```

## Does the laboratory has yeast identification systems?

```{r}
flg_yeast_levels <- c(
  "No, enviamos los aislados a otro laboratorio para su identificación", "Sí"
)
flg_yeast_labels <- c("No", "Yes")
```

```{r fig.height=2.5, fig.width=12, fig.align='center'}
flg_yeast_plt <- survey %>% 
  plt_simple(
    flg_identification_systems_yeast, flg_yeast_levels, flg_yeast_labels, 
    title = "Does the laboratory has yeast identification systems?"
  )

flg_yeast_plt
```

```{r}
download_plt(flg_yeast_plt, "flg_yeast", height = 2.5, width = 12)
```

### By region

```{r fig.height=2.5, fig.width=12, fig.align='center'}
flg_yeast_region_plt <- survey %>% 
  plt_simple_facet(
    flg_lima, flg_identification_systems_yeast, flg_yeast_levels, 
    flg_yeast_labels,
    title = "Does the laboratory has yeast identification systems?"
  )

flg_yeast_region_plt
```

```{r}
download_plt(
  flg_yeast_region_plt, "flg_yeast_region", height = 2.5, width = 12
)
```

### By capacity

```{r fig.height=2.5, fig.width=12, fig.align='center'}
flg_yeast_capacity_plt <- survey %>% 
  plt_simple_facet(
    capacity, flg_identification_systems_yeast, flg_yeast_levels, 
    flg_yeast_labels,
    title = "Does the laboratory has yeast identification systems?"
  )

flg_yeast_capacity_plt
```

```{r}
download_plt(
  flg_yeast_capacity_plt, "flg_yeast_capacity", height = 2.5, width = 12
)
```

## Available yeast identification systems

```{r}
yeast_indenti_labels <- c(
  "Chromogenic medium", "Manual biochemical methods", 
  "Semi-automated\nidentification kit", "MALDI-TOF", "VITEK 2", "BD Phoenix",
  "MicroScan", "DNA sequencing", "Others"
)
```

```{r fig.height=6, fig.width=12, fig.align='center'}
yeast_indenti_plt <- survey %>% 
  plot_multiple(
    identification_systems_yeast___1:identification_systems_yeast___9, 
    labels = yeast_indenti_labels, 
    title = "What yeast identification systems are available in your laboratory?",
    fill_label = "Available?"
  )

yeast_indenti_plt
```

```{r}
download_plt(yeast_indenti_plt, "yeast_indenti_systems", height = 4, width = 12)
```

### By region

```{r fig.height=4.5, fig.width=12, fig.align='center'}
yeast_indenti_region_plt <- survey %>% 
  plot_multiple_facet(
    facet = flg_lima, 
    identification_systems_yeast___1:identification_systems_yeast___9, 
    labels = yeast_indenti_labels, 
    title = "What yeast identification systems are available in your laboratory?",
    fill_label = "Available?"
  )

yeast_indenti_region_plt
```

```{r}
download_plt(
  yeast_indenti_region_plt, "yeast_indenti_region", height = 4.5, 
  width = 12
)
```

### By capacity

```{r fig.height=4.5, fig.width=12, fig.align='center'}
yeast_indenti_capacity_plt <- survey %>% 
  plot_multiple_facet(
    facet = capacity, 
    identification_systems_yeast___1:identification_systems_yeast___9, 
    labels = yeast_indenti_labels, 
    title = "What yeast identification systems are available in your laboratory?",
    fill_label = "Available?"
  )

yeast_indenti_capacity_plt
```

```{r}
download_plt(
  yeast_indenti_capacity_plt, "yeast_indenti_capacity", height = 4.5, 
  width = 12
)
```

## Routine storage of clinical yeast isolates

```{r fig.height=2.5, fig.width=12, fig.align='center'}
flg_yeast_storage_plt <- survey %>% 
  plt_simple(
    flg_store_yeast_isolates, yes_no_levels, yes_no_labels, 
    title = "Does the laboratory routinely stock clinical yeast isolates?"
  )

flg_yeast_storage_plt
```

```{r}
download_plt(flg_yeast_storage_plt, "flg_yeast_storage", height = 2.5, width = 12)
```

### By region

```{r fig.height=2.5, fig.width=12, fig.align='center'}
flg_yeast_storage_region_plt <- survey %>% 
  plt_simple_facet(
    flg_lima, flg_store_yeast_isolates, yes_no_levels, yes_no_labels,
    title = "Does the laboratory routinely stock clinical yeast isolates?"
  )

flg_yeast_storage_region_plt
```

```{r}
download_plt(
  flg_yeast_storage_region_plt, "flg_yeast_storage_region", height = 2.5, width = 12
)
```

### By capacity

```{r fig.height=2.5, fig.width=12, fig.align='center'}
flg_yeast_storage_capacity_plt <- survey %>% 
  plt_simple_facet(
    capacity, flg_store_yeast_isolates, yes_no_levels, yes_no_labels,
    title = "Does the laboratory routinely stock clinical yeast isolates?"
  )

flg_yeast_storage_capacity_plt
```

```{r}
download_plt(
  flg_yeast_storage_capacity_plt, "flg_yeast_storage_capacity", height = 2.5, width = 12
)
```

# Fungal identification: Mold (Filamentous/Dimorphic Fungi)

## Available culture medias for mold identification

```{r fig.height=4, fig.width=12, fig.align='center'}
mold_culture_medias_plt <- survey %>% 
  plot_multiple(
    culture_media_mold___1:culture_media_mold___5, 
    labels = culture_media_labels, 
    title = "Which types of culture medias are available in your laboratory for mold identification?",
    fill_label = "Available?"
  )

mold_culture_medias_plt
```

```{r}
download_plt(mold_culture_medias_plt, "mold_culture_medias", height = 4, width = 12)
```

### By region

```{r fig.height=3.5, fig.width=12, fig.align='center'}
mold_culture_medias_region_plt <- survey %>% 
  plot_multiple_facet(
    facet = flg_lima, 
    culture_media_mold___1:culture_media_mold___5, 
    labels = culture_media_labels, 
    title = "Which types of culture medias are available in your laboratory for mold identification?",
    fill_label = "Available?"
  )

mold_culture_medias_region_plt
```

```{r}
download_plt(
  mold_culture_medias_region_plt, "mold_culture_medias_region", height = 3.5, 
  width = 12
)
```

### By capacity

```{r fig.height=3.5, fig.width=12, fig.align='center'}
mold_culture_medias_capacity_plt <- survey %>% 
  plot_multiple_facet(
    facet = capacity, 
    culture_media_mold___1:culture_media_mold___5, 
    labels = culture_media_labels, 
    title = "Which types of culture medias are available in your laboratory for mold identification?",
    fill_label = "Available?"
  )

mold_culture_medias_capacity_plt
```

```{r}
download_plt(
  mold_culture_medias_capacity_plt, "mold_culture_medias_capacity", height = 3.5, 
  width = 12
)
```

## Does the laboratory has mold identification systems?

```{r fig.height=2.5, fig.width=12, fig.align='center'}
flg_mold_plt <- survey %>% 
  plt_simple(
    flg_identification_systems_mold, yes_no_levels, yes_no_labels, 
    title = "Does the laboratory has mold identification systems?"
  )

flg_mold_plt
```

```{r}
download_plt(flg_mold_plt, "flg_mold", height = 2.5, width = 12)
```

### By region

```{r fig.height=2.5, fig.width=12, fig.align='center'}
flg_mold_region_plt <- survey %>% 
  plt_simple_facet(
    flg_lima, flg_identification_systems_mold, yes_no_levels, yes_no_labels,
    title = "Does the laboratory has mold identification systems?"
  )

flg_mold_region_plt
```

```{r}
download_plt(
  flg_mold_region_plt, "flg_mold_region", height = 2.5, width = 12
)
```

### By capacity

```{r fig.height=2.5, fig.width=12, fig.align='center'}
flg_mold_capacity_plt <- survey %>% 
  plt_simple_facet(
    capacity, flg_identification_systems_mold, yes_no_levels, yes_no_labels,
    title = "Does the laboratory has mold identification systems?"
  )

flg_mold_capacity_plt
```

```{r}
download_plt(
  flg_mold_capacity_plt, "flg_mold_capacity", height = 2.5, width = 12
)
```

## Does the laboratory send mold isolates to external labs for identification?

```{r fig.height=3, fig.width=12, fig.align='center'}
flg_mold_ext_plt <- survey %>% 
  filter(flg_identification_systems_mold == "No") %>% 
  plt_simple(
    flg_identif_mold_ext_lab, yes_no_levels, yes_no_labels, 
    title = "Does the laboratory send mold isolates to external labs for identification?"
  )

flg_mold_ext_plt
```

```{r}
download_plt(flg_mold_ext_plt, "flg_mold_external", height = 3, width = 12)
```

### By region

```{r fig.height=3, fig.width=12, fig.align='center'}
flg_mold_ext_region_plt <- survey %>% 
  filter(flg_identification_systems_mold == "No") %>% 
  plt_simple_facet(
    flg_lima, flg_identif_mold_ext_lab, yes_no_levels, yes_no_labels,
    title = "Does the laboratory send mold isolates to external labs for identification?"
  )

flg_mold_ext_region_plt
```

```{r}
download_plt(
  flg_mold_ext_region_plt, "flg_mold_ext_region", height = 3, width = 12
)
```

### By capacity

```{r fig.height=3, fig.width=12, fig.align='center'}
flg_mold_ext_capacity_plt <- survey %>% 
  filter(flg_identification_systems_mold == "No") %>% 
  plt_simple_facet(
    flg_lima, flg_identif_mold_ext_lab, yes_no_levels, yes_no_labels,
    title = "Does the laboratory send mold isolates to external labs for identification?"
  )

flg_mold_ext_capacity_plt
```

```{r}
download_plt(
  flg_mold_ext_capacity_plt, "flg_mold_ext_capacity", height = 3, width = 12
)
```

## Available mold identification systems

```{r}
mold_indenti_labels <- c(
  "Morphological\ncharacterization", "MALDI-TOF", "DNA sequencing", "Others"
)
```

```{r fig.height=3.5, fig.width=12, fig.align='center'}
mold_indenti_plt <- survey %>% 
  plot_multiple(
    identification_systems_mold___1:identification_systems_mold___4, 
    labels = mold_indenti_labels, 
    title = "What mold identification systems are available in your laboratory?",
    fill_label = "Available?"
  )

mold_indenti_plt
```

```{r}
download_plt(mold_indenti_plt, "mold_indenti_systems", height = 3.5, width = 12)
```

### By region

```{r fig.height=3, fig.width=12, fig.align='center'}
mold_indenti_region_plt <- survey %>% 
  plot_multiple_facet(
    facet = flg_lima, 
    identification_systems_mold___1:identification_systems_mold___4, 
    labels = mold_indenti_labels, 
    title = "What mold identification systems are available in your laboratory?",
    fill_label = "Available?"
  )

mold_indenti_region_plt
```

```{r}
download_plt(
  mold_indenti_region_plt, "mold_indenti_region", height = 3, width = 12
)
```

### By capacity

```{r fig.height=3, fig.width=12, fig.align='center'}
mold_indenti_capacity_plt <- survey %>% 
  plot_multiple_facet(
    facet = flg_lima, 
    identification_systems_mold___1:identification_systems_mold___4, 
    labels = mold_indenti_labels, 
    title = "What mold identification systems are available in your laboratory?",
    fill_label = "Available?"
  )

mold_indenti_capacity_plt
```

```{r}
download_plt(
  mold_indenti_capacity_plt, "mold_indenti_capacity", height = 3, width = 12
)
```

## Routine storage of clinical yeast isolates

```{r fig.height=2.5, fig.width=12, fig.align='center'}
flg_mold_storage_plt <- survey %>% 
  plt_simple(
    flg_store_mold_isolates, yes_no_levels, yes_no_labels, 
    title = "Does the laboratory routinely stock clinical mold isolates?"
  )

flg_mold_storage_plt
```

```{r}
download_plt(flg_mold_storage_plt, "flg_mold_storage", height = 2.5, width = 12)
```

### By region

```{r fig.height=2.5, fig.width=12, fig.align='center'}
flg_mold_storage_region_plt <- survey %>% 
  plt_simple_facet(
    flg_lima, flg_store_mold_isolates, yes_no_levels, yes_no_labels,
    title = "Does the laboratory routinely stock clinical mold isolates?"
  )

flg_mold_storage_region_plt
```

```{r}
download_plt(
  flg_mold_storage_region_plt, "flg_mold_storage_region", height = 2.5, width = 12
)
```

### By capacity

```{r fig.height=2.5, fig.width=12, fig.align='center'}
flg_mold_storage_capacity_plt <- survey %>% 
  plt_simple_facet(
    flg_lima, flg_store_mold_isolates, yes_no_levels, yes_no_labels,
    title = "Does the laboratory routinely stock clinical mold isolates?"
  )

flg_mold_storage_capacity_plt
```

```{r}
download_plt(
  flg_mold_storage_capacity_plt, "flg_mold_storage_capacity", height = 2.5, width = 12
)
```

# Antifungal susceptibility testing

```{r fig.height=2.5, fig.width=12, fig.align='center'}
flg_antifungal_plt <- survey %>% 
  plt_simple(
    flg_antifungal_suscep_tests, yes_no_levels, yes_no_labels, 
    title = "Does the laboratory offer in-vitro antifungal susceptibility testing services?"
  )

flg_antifungal_plt
```

```{r}
download_plt(flg_antifungal_plt, "flg_antifungal", height = 2.5, width = 12)
```

### By region

```{r fig.height=2.5, fig.width=12, fig.align='center'}
flg_antifungal_region_plt <- survey %>% 
  plt_simple_facet(
    flg_lima, flg_antifungal_suscep_tests, yes_no_levels, yes_no_labels,
    title = "Does the laboratory offer in-vitro antifungal susceptibility testing services?"
  )

flg_antifungal_region_plt
```

```{r}
download_plt(
  flg_antifungal_region_plt, "flg_antifungal_region", height = 2.5, width = 12
)
```

### By capacity

```{r fig.height=2.5, fig.width=12, fig.align='center'}
flg_antifungal_capacity_plt <- survey %>% 
  plt_simple_facet(
    capacity, flg_antifungal_suscep_tests, yes_no_levels, yes_no_labels,
    title = "Does the laboratory offer in-vitro antifungal susceptibility testing services?"
  )

flg_antifungal_capacity_plt
```

```{r}
download_plt(
  flg_antifungal_capacity_plt, "flg_antifungal_capacity", height = 2.5, width = 12
)
```

## Does the laboratory perform the antifungal susceptibility tests or are they sent to an external laboratory?

```{r}
flg_antifungal_lab_levels <- c(
  "No, se envían a un laboratorio externo", "Sí, se realizan en el laboratorio"
)
flg_antifungal_lab_labels <- c(
  "No, they are sent to\nan external laboratory", "Yes"
)
```

```{r fig.height=2.5, fig.width=12, fig.align='center'}
flg_antifungal_lab_plt <- survey %>% 
  filter(flg_antifungal_suscep_tests == "Sí") %>% 
  plt_simple(
    flg_antifungal_suscep_tests_lab, flg_antifungal_lab_levels, flg_antifungal_lab_labels, 
    title = "Does the laboratory perform the antifungal susceptibility tests or are they sent to\nan external laboratory?"
  )

flg_antifungal_lab_plt
```

```{r}
download_plt(flg_antifungal_lab_plt, "flg_antifungal_lab", height = 2.5, width = 12)
```

### By region

```{r fig.height=2.5, fig.width=12, fig.align='center'}
flg_antifungal_lab_region_plt <- survey %>% 
  filter(flg_antifungal_suscep_tests == "Sí") %>% 
  plt_simple_facet(
    flg_lima, flg_antifungal_suscep_tests_lab, flg_antifungal_lab_levels, 
    flg_antifungal_lab_labels,
    title = "Does the laboratory perform the antifungal susceptibility tests or are they sent to\nan external laboratory?"
  )

flg_antifungal_lab_region_plt
```

```{r}
download_plt(
  flg_antifungal_region_plt, "flg_antifungal_region", height = 2.5, width = 12
)
```

### By capacity

```{r fig.height=2.5, fig.width=12, fig.align='center'}
flg_antifungal_lab_capacity_plt <- survey %>% 
  filter(flg_antifungal_suscep_tests == "Sí") %>% 
  plt_simple_facet(
    capacity, flg_antifungal_suscep_tests_lab, flg_antifungal_lab_levels, 
    flg_antifungal_lab_labels,
    title = "Does the laboratory perform the antifungal susceptibility tests or are they sent to\nan external laboratory?"
  )

flg_antifungal_lab_capacity_plt
```

```{r}
download_plt(
  flg_antifungal_capacity_plt, "flg_antifungal_capacity", height = 2.5, width = 12
)
```

## What types of fungi are antifungal susceptibility tests available for?

```{r}
fungi_antifungal_labels <- c("Yeast", "Mold")
```

```{r fig.height=2.5, fig.width=12, fig.align='center'}
fungi_antifungal_plt <- survey %>% 
  plot_multiple(
    type_fungi_antifungal_suscep_tests___1:type_fungi_antifungal_suscep_tests___2, 
    labels = fungi_antifungal_labels, 
    title = "What types of fungi are antifungal susceptibility tests available for?",
    fill_label = "Available?"
  )

fungi_antifungal_plt
```

```{r}
download_plt(fungi_antifungal_plt, "fungi_antifungal", height = 2.5, width = 12)
```

### By region

```{r fig.height=3, fig.width=12, fig.align='center'}
fungi_antifungal_region_plt <- survey %>% 
  plot_multiple_facet(
    facet = flg_lima, 
    type_fungi_antifungal_suscep_tests___1:type_fungi_antifungal_suscep_tests___2, 
    labels = fungi_antifungal_labels, 
    title = "What types of fungi are antifungal susceptibility tests available for?",
    fill_label = "Available?"
  )

fungi_antifungal_region_plt
```

```{r}
download_plt(
  fungi_antifungal_region_plt, "fungi_antifungal_region", height = 3, 
  width = 12
)
```

### By capacity

```{r fig.height=3, fig.width=12, fig.align='center'}
fungi_antifungal_capacity_plt <- survey %>% 
  plot_multiple_facet(
    facet = capacity, 
    type_fungi_antifungal_suscep_tests___1:type_fungi_antifungal_suscep_tests___2, 
    labels = fungi_antifungal_labels, 
    title = "What types of fungi are antifungal susceptibility tests available for?",
    fill_label = "Available?"
  )

fungi_antifungal_capacity_plt
```

```{r}
download_plt(
  fungi_antifungal_capacity_plt, "fungi_antifungal_capacity", height = 3, 
  width = 12
)
```

# Serological tests

## Are antibody tests against fungi (*Aspergillus sp.*, *Histoplasma capsulatum*, *Paracoccidioides brasiliensis*) available in your laboratory?

```{r fig.height=2.5, fig.width=12, fig.align='center'}
flg_antibody_plt <- survey %>% 
  plt_simple(
    flg_antifungal_antibodies_tests_lab, yes_no_levels, yes_no_labels, 
    title = "Are antibody tests against fungi available in your laboratory?"
  )

flg_antibody_plt
```

```{r}
download_plt(flg_antibody_plt, "flg_antibody_tests", height = 2.5, width = 12)
```

### By region

```{r fig.height=2.5, fig.width=12, fig.align='center'}
flg_antibody_region_plt <- survey %>% 
  plt_simple_facet(
    flg_lima, flg_antifungal_antibodies_tests_lab, yes_no_levels, yes_no_labels,
    title = "Are antibody tests against fungi available in your laboratory?"
  )

flg_antibody_region_plt
```

```{r}
download_plt(
  flg_antibody_region_plt, "flg_antifungal_lab_region", height = 2.5, width = 12
)
```

### By capacity

```{r fig.height=2.5, fig.width=12, fig.align='center'}
flg_antibody_capacity_plt <- survey %>% 
  plt_simple_facet(
    capacity, flg_antifungal_antibodies_tests_lab, yes_no_levels, yes_no_labels,
    title = "Are antibody tests against fungi available in your laboratory?"
  )

flg_antibody_capacity_plt
```

```{r}
download_plt(
  flg_antibody_capacity_plt, "flg_antifungal_lab_capacity", height = 2.5, width = 12
)
```

## Are antibody tests against fungi available in another laboratory in your hospital?

```{r fig.height=2.5, fig.width=12, fig.align='center'}
flg_antibody_other_plt <- survey %>% 
  filter(flg_antifungal_antibodies_tests_lab == "No") %>% 
  plt_simple(
    flg_antifungal_antibodies_tests_other_lab, yes_no_levels, yes_no_labels, 
    title = "Are antibody tests against fungi available in another laboratory in your hospital?"
  )

flg_antibody_other_plt
```

```{r}
download_plt(flg_antibody_other_plt, "flg_antibody_tests_other", height = 2.5, width = 12)
```

### By region

```{r fig.height=2.5, fig.width=12, fig.align='center'}
flg_antibody_other_region_plt <- survey %>% 
  filter(flg_antifungal_antibodies_tests_lab == "No") %>% 
  plt_simple_facet(
    flg_lima, flg_antifungal_antibodies_tests_other_lab, yes_no_levels, yes_no_labels,
    title = "Are antibody tests against fungi available in another laboratory in your hospital?"
  )

flg_antibody_other_region_plt
```

```{r}
download_plt(
  flg_antibody_other_region_plt, "flg_antibody_other_region", height = 2.5, width = 12
)
```

### By capacity

```{r fig.height=2.5, fig.width=12, fig.align='center'}
flg_antibody_other_capacity_plt <- survey %>% 
  filter(flg_antifungal_antibodies_tests_lab == "No") %>% 
  plt_simple_facet(
    capacity, flg_antifungal_antibodies_tests_other_lab, yes_no_levels, yes_no_labels,
    title = "Are antibody tests against fungi available in another laboratory in your hospital?"
  )

flg_antibody_other_capacity_plt
```

```{r}
download_plt(
  flg_antibody_other_capacity_plt, "flg_antibody_other_capacity", height = 2.5, width = 12
)
```

## Are the tests for the detection of antibodies against fungi sent to an external laboratory?

```{r fig.height=2.5, fig.width=12, fig.align='center'}
flg_antibody_ext_plt <- survey %>% 
  filter(
    flg_antifungal_antibodies_tests_lab == "No", 
    flg_antifungal_antibodies_tests_other_lab == "No"
  ) %>% 
  plt_simple(
    flg_antifungal_antibodies_tests_ext_lab, yes_no_levels, yes_no_labels, 
    title = "Are the tests for the detection of antibodies against fungi sent to an external laboratory?"
  )

flg_antibody_ext_plt
```

```{r}
download_plt(flg_antibody_ext_plt, "flg_antibody_tests_ext", height = 2.5, width = 12)
```

### By region

```{r fig.height=2.5, fig.width=12, fig.align='center'}
flg_antibody_ext_region_plt <- survey %>% 
  filter(
    flg_antifungal_antibodies_tests_lab == "No", 
    flg_antifungal_antibodies_tests_other_lab == "No"
  ) %>% 
  plt_simple_facet(
    flg_lima, flg_antifungal_antibodies_tests_ext_lab, yes_no_levels, yes_no_labels,
    title = "Are the tests for the detection of antibodies against fungi sent to an external laboratory?"
  )

flg_antibody_ext_region_plt
```

```{r}
download_plt(
  flg_antibody_ext_region_plt, "flg_antibody_ext_region", height = 2.5, width = 12
)
```

### By capacity

```{r fig.height=2.5, fig.width=12, fig.align='center'}
flg_antibody_ext_capacity_plt <- survey %>% 
  filter(
    flg_antifungal_antibodies_tests_lab == "No", 
    flg_antifungal_antibodies_tests_other_lab == "No"
  ) %>% 
  plt_simple_facet(
    capacity, flg_antifungal_antibodies_tests_ext_lab, yes_no_levels, yes_no_labels,
    title = "Are the tests for the detection of antibodies against fungi sent to an external laboratory?"
  )

flg_antibody_ext_capacity_plt
```

```{r}
download_plt(
  flg_antibody_ext_capacity_plt, "flg_antibody_ext_capacity", height = 2.5, width = 12
)
```

## Are *Cryptococcus* antigen detection tests available in your laboratory?

```{r fig.height=2.5, fig.width=12, fig.align='center'}
flg_crypto_plt <- survey %>% 
  plt_simple(
    flg_crypto_antigens_test_lab, yes_no_levels, yes_no_labels, 
    title = "Are Cryptococcus antigen detection tests available in your laboratory?"
  )

flg_crypto_plt
```

```{r}
download_plt(flg_crypto_plt, "flg_cryptococcus", height = 2.5, width = 12)
```

### By region

```{r fig.height=2.5, fig.width=12, fig.align='center'}
flg_crypto_region_plt <- survey %>% 
  plt_simple_facet(
    flg_lima, flg_crypto_antigens_test_lab, yes_no_levels, yes_no_labels,
    title = "Are Cryptococcus antigen detection tests available in your laboratory?"
  )

flg_crypto_region_plt
```

```{r}
download_plt(
  flg_crypto_region_plt, "flg_crypto_region", height = 2.5, width = 12
)
```

### By capacity

```{r fig.height=2.5, fig.width=12, fig.align='center'}
flg_crypto_capacity_plt <- survey %>% 
  plt_simple_facet(
    capacity, flg_crypto_antigens_test_lab, yes_no_levels, yes_no_labels,
    title = "Are Cryptococcus antigen detection tests available in your laboratory?"
  )

flg_crypto_capacity_plt
```

```{r}
download_plt(
  flg_crypto_capacity_plt, "flg_crypto_capacity", height = 2.5, width = 12
)
```

## Are *Cryptococcus* antigen tests available at another lab in the hospital?

```{r fig.height=2.5, fig.width=12, fig.align='center'}
flg_crypto_other_plt <- survey %>% 
  filter(flg_crypto_antigens_test_lab == "No") %>% 
  plt_simple(
    flg_crypto_antigens_test_other_lab, yes_no_levels, yes_no_labels, 
    title = "Are Cryptococcus antigen tests available at another lab in the hospital?"
  )

flg_crypto_other_plt
```

```{r}
download_plt(flg_crypto_other_plt, "flg_cryptococcus_other", height = 2.5, width = 12)
```

### By region

```{r fig.height=2.5, fig.width=12, fig.align='center'}
flg_crypto_other_region_plt <- survey %>% 
  filter(flg_crypto_antigens_test_lab == "No") %>% 
  plt_simple_facet(
    flg_lima, flg_crypto_antigens_test_other_lab, yes_no_levels, yes_no_labels,
    title = "Are Cryptococcus antigen tests available at another lab in the hospital?"
  )

flg_crypto_other_region_plt
```

```{r}
download_plt(
  flg_crypto_other_region_plt, "flg_crypto_other_region", height = 2.5, width = 12
)
```

### By capacity

```{r fig.height=2.5, fig.width=12, fig.align='center'}
flg_crypto_other_capacity_plt <- survey %>% 
  filter(flg_crypto_antigens_test_lab == "No") %>% 
  plt_simple_facet(
    capacity, flg_crypto_antigens_test_other_lab, yes_no_levels, yes_no_labels,
    title = "Are Cryptococcus antigen tests available at another lab in the hospital?"
  )

flg_crypto_other_capacity_plt
```

```{r}
download_plt(
  flg_crypto_other_capacity_plt, "flg_crypto_other_capacity", height = 2.5, width = 12
)
```


## Are *Cryptococcus* antigen tests sent to an external laboratory?

```{r fig.height=2.5, fig.width=12, fig.align='center'}
flg_crypto_ext_plt <- survey %>% 
  filter(
    flg_crypto_antigens_test_lab == "No", 
    flg_crypto_antigens_test_other_lab == "No"
  ) %>% 
  plt_simple(
    flg_crypto_antigens_test_ext_lab, yes_no_levels, yes_no_labels, 
    title = "Are Cryptococcus antigen tests sent to an external lab?"
  )

flg_crypto_ext_plt
```

```{r}
download_plt(flg_crypto_ext_plt, "flg_cryptococcus_ext", height = 2.5, width = 12)
```

### By region

```{r fig.height=2.5, fig.width=12, fig.align='center'}
flg_crypto_ext_region_plt <- survey %>% 
  filter(
    flg_crypto_antigens_test_lab == "No", 
    flg_crypto_antigens_test_other_lab == "No"
  ) %>% 
  plt_simple_facet(
    flg_lima, flg_crypto_antigens_test_ext_lab, yes_no_levels, yes_no_labels,
    title = "Are Cryptococcus antigen tests sent to an external lab?"
  )

flg_crypto_ext_region_plt
```

```{r}
download_plt(
  flg_crypto_ext_region_plt, "flg_crypto_ext_region", height = 2.5, width = 12
)
```

### By capacity

```{r fig.height=2.5, fig.width=12, fig.align='center'}
flg_crypto_ext_capacity_plt <- survey %>% 
  filter(
    flg_crypto_antigens_test_lab == "No", 
    flg_crypto_antigens_test_other_lab == "No"
  ) %>% 
  plt_simple_facet(
    flg_lima, flg_crypto_antigens_test_ext_lab, yes_no_levels, yes_no_labels,
    title = "Are Cryptococcus antigen tests sent to an external lab?"
  )

flg_crypto_ext_capacity_plt
```

```{r}
download_plt(
  flg_crypto_ext_capacity_plt, "flg_crypto_ext_capacity", height = 2.5, width = 12
)
```

## Which antigen detection tests for Cryptococcus are available in your laboratory or hospital?

```{r}
antigen_crypto_labels <- c(
  "Latex agglutination\ntest", "ELISA", "Lateral flow\nassay", "Other"
)
```

```{r fig.height=3.5, fig.width=12, fig.align='center'}
antigen_crypto_plt <- survey %>% 
  plot_multiple(
    type_crypto_antigens_test___1:type_crypto_antigens_test___4, 
    labels = antigen_crypto_labels, 
    title = "Which antigen detection tests for Cryptococcus are available in your laboratory or hospital?",
    fill_label = "Available?"
  )

antigen_crypto_plt
```

## Are *Histoplasma capsulatum* antigen detection tests available in your laboratory?

```{r fig.height=2.5, fig.width=12, fig.align='center'}
flg_histo_plt <- survey %>% 
  plt_simple(
    flg_histo_antigens_test_lab, yes_no_levels, yes_no_labels, 
    title = "Are Histoplasma capsulatum antigen detection tests available in your laboratory?"
  )

flg_histo_plt
```

```{r}
download_plt(flg_histo_plt, "flg_histoplasma", height = 2.5, width = 12)
```

### By region

```{r fig.height=2.5, fig.width=12, fig.align='center'}
flg_histo_region_plt <- survey %>% 
  plt_simple_facet(
    flg_lima, flg_histo_antigens_test_lab, yes_no_levels, yes_no_labels,
    title = "Are Histoplasma capsulatum antigen detection tests available in your laboratory?"
  )

flg_histo_region_plt
```

```{r}
download_plt(
  flg_histo_region_plt, "flg_histo_region", height = 2.5, width = 12
)
```

### By capacity

```{r fig.height=2.5, fig.width=12, fig.align='center'}
flg_histo_capacity_plt <- survey %>% 
  plt_simple_facet(
    capacity, flg_histo_antigens_test_lab, yes_no_levels, yes_no_labels,
    title = "Are Histoplasma capsulatum antigen detection tests available in your laboratory?"
  )

flg_histo_capacity_plt
```

```{r}
download_plt(
  flg_histo_capacity_plt, "flg_histo_capacity", height = 2.5, width = 12
)
```

## Are *Histoplasma capsulatum* antigen tests available at another lab in the hospital?

```{r fig.height=2.5, fig.width=12, fig.align='center'}
flg_histo_other_plt <- survey %>% 
  filter(flg_histo_antigens_test_lab == "No") %>% 
  plt_simple(
    flg_histo_antigens_test_other_lab, yes_no_levels, yes_no_labels, 
    title = "Are Histoplasma capsulatum antigen tests available at another lab in the hospital?"
  )

flg_histo_other_plt
```

```{r}
download_plt(flg_histo_other_plt, "flg_histoplasma_other", height = 2.5, width = 12)
```

### By region

```{r fig.height=2.5, fig.width=12, fig.align='center'}
flg_histo_other_region_plt <- survey %>% 
  filter(flg_histo_antigens_test_lab == "No") %>% 
  plt_simple_facet(
    flg_lima, flg_histo_antigens_test_other_lab, yes_no_levels, yes_no_labels,
    title = "Are Histoplasma capsulatum antigen tests available at another lab in the hospital?"
  )

flg_histo_other_region_plt
```

```{r}
download_plt(
  flg_histo_other_region_plt, "flg_histo_other_region", height = 2.5, width = 12
)
```

### By capacity

```{r fig.height=2.5, fig.width=12, fig.align='center'}
flg_histo_other_capacity_plt <- survey %>% 
  filter(flg_histo_antigens_test_lab == "No") %>% 
  plt_simple_facet(
    capacity, flg_histo_antigens_test_other_lab, yes_no_levels, yes_no_labels,
    title = "Are Histoplasma capsulatum antigen tests available at another lab in the hospital?"
  )

flg_histo_other_capacity_plt
```

```{r}
download_plt(
  flg_histo_other_capacity_plt, "flg_histo_other_capacity", height = 2.5, width = 12
)
```

## Are *Histoplasma capsulatum* antigen tests sent to an external laboratory?

```{r fig.height=2.5, fig.width=12, fig.align='center'}
flg_histo_ext_plt <- survey %>% 
  filter(
    flg_histo_antigens_test_lab == "No", 
    flg_histo_antigens_test_other_lab == "No"
  ) %>% 
  plt_simple(
    flg_histo_antigens_test_ext_lab, yes_no_levels, yes_no_labels, 
    title = "Are Histoplasma capsulatum antigen tests sent to an external lab?"
  )

flg_histo_ext_plt
```

```{r}
download_plt(flg_histo_ext_plt, "flg_histoplasma_ext", height = 2.5, width = 12)
```

### By region

```{r fig.height=2.5, fig.width=12, fig.align='center'}
flg_histo_ext_region_plt <- survey %>% 
  filter(
    flg_histo_antigens_test_lab == "No", 
    flg_histo_antigens_test_other_lab == "No"
  ) %>% 
  plt_simple_facet(
    flg_lima, flg_histo_antigens_test_ext_lab, yes_no_levels, yes_no_labels,
    title = "Are Cryptococcus antigen tests sent to an external lab?"
  )

flg_histo_ext_region_plt
```

```{r}
download_plt(
  flg_histo_ext_region_plt, "flg_histo_ext_region", height = 2.5, width = 12
)
```

### By capacity

```{r fig.height=2.5, fig.width=12, fig.align='center'}
flg_histo_ext_capacity_plt <- survey %>% 
  filter(
    flg_histo_antigens_test_lab == "No", 
    flg_histo_antigens_test_other_lab == "No"
  ) %>% 
  plt_simple_facet(
    flg_lima, flg_histo_antigens_test_ext_lab, yes_no_levels, yes_no_labels,
    title = "Are Cryptococcus antigen tests sent to an external lab?"
  )

flg_histo_ext_capacity_plt
```

```{r}
download_plt(
  flg_histo_ext_capacity_plt, "flg_histo_ext_capacity", height = 2.5, width = 12
)
```

## Are *Aspergillus sp.* antigen detection tests available in your laboratory?

```{r fig.height=2.5, fig.width=12, fig.align='center'}
flg_asper_plt <- survey %>% 
  plt_simple(
    flg_asper_antigens_test_lab, yes_no_levels, yes_no_labels, 
    title = "Are Aspergillus sp. antigen detection tests available in your laboratory?"
  )

flg_asper_plt
```

```{r}
download_plt(flg_asper_plt, "flg_aspergillus", height = 2.5, width = 12)
```

### By region

```{r fig.height=2.5, fig.width=12, fig.align='center'}
flg_asper_region_plt <- survey %>% 
  plt_simple_facet(
    flg_lima, flg_asper_antigens_test_lab, yes_no_levels, yes_no_labels,
    title = "Are Aspergillus sp. antigen detection tests available in your laboratory?"
  )

flg_asper_region_plt
```

```{r}
download_plt(
  flg_asper_region_plt, "flg_asper_region", height = 2.5, width = 12
)
```

### By capacity

```{r fig.height=2.5, fig.width=12, fig.align='center'}
flg_asper_capacity_plt <- survey %>% 
  plt_simple_facet(
    capacity, flg_asper_antigens_test_lab, yes_no_levels, yes_no_labels,
    title = "Are Aspergillus sp. antigen detection tests available in your laboratory?"
  )

flg_asper_capacity_plt
```

```{r}
download_plt(
  flg_asper_capacity_plt, "flg_asper_capacity", height = 2.5, width = 12
)
```

## Are *Aspergillus sp.* antigen tests available at another lab in the hospital?

```{r fig.height=2.5, fig.width=12, fig.align='center'}
flg_asper_other_plt <- survey %>% 
  filter(flg_asper_antigens_test_lab == "No") %>% 
  plt_simple(
    flg_asper_antigens_test_other_lab, yes_no_levels, yes_no_labels, 
    title = "Are Aspergillus sp. antigen tests available at another lab in the hospital?"
  )

flg_asper_other_plt
```

```{r}
download_plt(flg_asper_other_plt, "flg_aspergillus_other", height = 2.5, width = 12)
```

### By region

```{r fig.height=2.5, fig.width=12, fig.align='center'}
flg_asper_other_region_plt <- survey %>% 
  filter(flg_asper_antigens_test_lab == "No") %>% 
  plt_simple_facet(
    flg_lima, flg_asper_antigens_test_other_lab, yes_no_levels, yes_no_labels,
    title = "Are Aspergillus sp. antigen tests available at another lab in the hospital?"
  )

flg_asper_other_region_plt
```

```{r}
download_plt(
  flg_asper_other_region_plt, "flg_asper_other_region", height = 2.5, width = 12
)
```

### By capacity

```{r fig.height=2.5, fig.width=12, fig.align='center'}
flg_asper_other_capacity_plt <- survey %>% 
  filter(flg_asper_antigens_test_lab == "No") %>% 
  plt_simple_facet(
    capacity, flg_asper_antigens_test_other_lab, yes_no_levels, yes_no_labels,
    title = "Are Aspergillus sp. antigen tests available at another lab in the hospital?"
  )

flg_asper_other_capacity_plt
```

```{r}
download_plt(
  flg_asper_other_capacity_plt, "flg_asper_other_capacity", height = 2.5, width = 12
)
```

## Are *Aspergillus sp.* antigen tests sent to an external laboratory?

```{r fig.height=2.5, fig.width=12, fig.align='center'}
flg_asper_ext_plt <- survey %>% 
  filter(
    flg_asper_antigens_test_lab == "No", 
    flg_asper_antigens_test_other_lab == "No"
  ) %>% 
  plt_simple(
    flg_asper_antigens_test_ext_lab, yes_no_levels, yes_no_labels, 
    title = "Are Aspergillus sp. antigen tests sent to an external lab?"
  )

flg_asper_ext_plt
```

```{r}
download_plt(flg_asper_ext_plt, "flg_aspergillus_ext", height = 2.5, width = 12)
```

### By region

```{r fig.height=2.5, fig.width=12, fig.align='center'}
flg_asper_ext_region_plt <- survey %>% 
  filter(
    flg_asper_antigens_test_lab == "No", 
    flg_asper_antigens_test_other_lab == "No"
  ) %>% 
  plt_simple_facet(
    flg_lima, flg_asper_antigens_test_ext_lab, yes_no_levels, yes_no_labels,
    title = "Are Aspergillus sp. antigen tests sent to an external lab?"
  )

flg_asper_ext_region_plt
```

```{r}
download_plt(
  flg_asper_ext_region_plt, "flg_asper_ext_region", height = 2.5, width = 12
)
```

### By capacity

```{r fig.height=2.5, fig.width=12, fig.align='center'}
flg_asper_ext_capacity_plt <- survey %>% 
  filter(
    flg_asper_antigens_test_lab == "No", 
    flg_asper_antigens_test_other_lab == "No"
  ) %>% 
  plt_simple_facet(
    flg_lima, flg_asper_antigens_test_ext_lab, yes_no_levels, yes_no_labels,
    title = "Are Aspergillus sp. antigen tests sent to an external lab?"
  )

flg_asper_ext_capacity_plt
```

```{r}
download_plt(
  flg_asper_ext_capacity_plt, "flg_asper_ext_capacity", height = 2.5, width = 12
)
```

# Molecular diagnosis

## Are PCR tests for the diagnosis of fungi available in your laboratory/hospital?

```{r fig.height=2.5, fig.width=12, fig.align='center'}
flg_pcr_plt <- survey %>% 
  plt_simple(
    flg_pcr_fungal_diagnosis_tests_lab, yes_no_levels, yes_no_labels, 
    title = "Are PCR tests for the diagnosis of fungi available in your laboratory/hospital?"
  )

flg_pcr_plt
```

```{r}
download_plt(flg_pcr_plt, "flg_pcr", height = 2.5, width = 12)
```

### By region

```{r fig.height=2.5, fig.width=12, fig.align='center'}
flg_pcr_region_plt <- survey %>% 
  plt_simple_facet(
    flg_lima, flg_pcr_fungal_diagnosis_tests_lab, yes_no_levels, yes_no_labels,
    title = "Are PCR tests for the diagnosis of fungi available in your laboratory/hospital?"
  )

flg_pcr_region_plt
```

```{r}
download_plt(
  flg_pcr_region_plt, "flg_pcr_region", height = 2.5, width = 12
)
```

### By capacity

```{r fig.height=2.5, fig.width=12, fig.align='center'}
flg_pcr_capacity_plt <- survey %>% 
  plt_simple_facet(
    capacity, flg_pcr_fungal_diagnosis_tests_lab, yes_no_levels, yes_no_labels,
    title = "Are PCR tests for the diagnosis of fungi available in your laboratory/hospital?"
  )

flg_pcr_capacity_plt
```

```{r}
download_plt(
  flg_pcr_capacity_plt, "flg_pcr_capacity", height = 2.5, width = 12
)
```

## Available PCR tests for the diagnosis of fungi

```{r}
pcr_labels <- c("Commercial\ntests", "In-house\ndeveloped tests")
```

```{r fig.height=2.5, fig.width=12, fig.align='center'}
pcr_plt <- survey %>% 
  plot_multiple(
    type_pcr_fungal_diganosis_tests___1:type_pcr_fungal_diganosis_tests___2, 
    labels = pcr_labels, 
    title = "Which PCR test for the diagnosis of fungi are available in your laboratory or hospital?",
    fill_label = "Available?"
  )

pcr_plt
```

```{r}
download_plt(pcr_plt, "pcr_test", height = 2.5, width = 12)
```

# Other capacities

## Available antifungals for the treatment of patients

```{r}
antifungal_labels <- c(
  "Fluconazole", "Voriconazole", "Posaconazole", "Amphotericin B\ndeoxycholate", 
  "Liposomal\nAmphotericin", "Anidulafungin", "Caspofungin", "Itraconazole", 
  "Others"
)
```

```{r fig.height=5, fig.width=12, fig.align='center'}
antifungal_plt <- survey %>% 
  plot_multiple(
    antifungal_pacient_treatment___1:antifungal_pacient_treatment___9, 
    labels = antifungal_labels, 
    title = "Which antifungals are available in your hospital for the treatment of patients?",
    fill_label = "Available?"
  )

antifungal_plt
```

```{r}
download_plt(antifungal_plt, "antifungals", height = 2.5, width = 12)
```

### By region

```{r fig.height=5.5, fig.width=12, fig.align='center'}
antifungal_region_plt <- survey %>% 
  plot_multiple_facet(
    facet = flg_lima, antifungal_pacient_treatment___1:antifungal_pacient_treatment___9, 
    labels = antifungal_labels, 
    title = "Which antifungals are available in your hospital for the treatment of patients?",
    fill_label = "Available?"
  )

antifungal_region_plt
```

```{r}
download_plt(antifungal_region_plt, "antifungals_region", height = 5.5, width = 12)
```

### By capacity

```{r fig.height=5.5, fig.width=12, fig.align='center'}
antifungal_capacity_plt <- survey %>% 
  plot_multiple_facet(
    facet = capacity, antifungal_pacient_treatment___1:antifungal_pacient_treatment___9, 
    labels = antifungal_labels, 
    title = "Which antifungals are available in your hospital for the treatment of patients?",
    fill_label = "Available?"
  )

antifungal_capacity_plt
```

```{r}
download_plt(antifungal_capacity_plt, "antifungals_capacity", height = 5.5, width = 12)
```
